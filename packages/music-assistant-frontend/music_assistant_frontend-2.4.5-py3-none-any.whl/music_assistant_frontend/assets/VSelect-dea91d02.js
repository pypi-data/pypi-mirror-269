import{m as re,V as q}from"./VTextField-7036077f.js";import{s as Q,w as E,p as Y,aN as ce,aC as de,g as fe,aO as ve,r as B,h as U,c as b,aZ as me,l as s,F as _,n as x,a$ as pe,Q as he,b0 as ye,q as ge,b1 as j}from"./index-b12bd80e.js";import{j as Ve,c as ke,V as we}from"./VInput-07934be9.js";import{I as be,i as Ce,n as z,j as Pe,F as xe}from"./forwardRefs-ccde8f15.js";import{l as Se,k as De,n as Te,e as Ie,b as Ae,V as W,d as Fe}from"./VMenu-29f14170.js";import{V as Re}from"./VVirtualScroll-36f43258.js";function Be(e,L){const n=Q(!1);let y;function m(i){cancelAnimationFrame(y),n.value=!0,y=requestAnimationFrame(()=>{y=requestAnimationFrame(()=>{n.value=!1})})}async function T(){await new Promise(i=>requestAnimationFrame(i)),await new Promise(i=>requestAnimationFrame(i)),await new Promise(i=>requestAnimationFrame(i)),await new Promise(i=>{if(n.value){const o=E(n,()=>{o(),i()})}else i()})}async function I(i){var A,F;if(i.key==="Tab"&&((A=L.value)==null||A.focus()),!["PageDown","PageUp","Home","End"].includes(i.key))return;const o=(F=e.value)==null?void 0:F.$el;if(!o)return;(i.key==="Home"||i.key==="End")&&o.scrollTo({top:i.key==="Home"?0:o.scrollHeight,behavior:"smooth"}),await T();const g=o.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if(i.key==="PageDown"||i.key==="Home"){const a=o.getBoundingClientRect().top;for(const V of g)if(V.getBoundingClientRect().top>=a){V.focus();break}}else{const a=o.getBoundingClientRect().bottom;for(const V of[...g].reverse())if(V.getBoundingClientRect().bottom<=a){V.focus();break}}}return{onListScroll:m,onListKeydown:I}}const Le=Y({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,listProps:{type:Object},menu:Boolean,menuIcon:{type:ce,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...Se({itemChildren:!1})},"Select"),Oe=Y({...Le(),...de(re({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...be({transition:{component:De}})},"VSelect"),$e=fe()({name:"VSelect",props:Oe(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,L){let{slots:n}=L;const{t:y}=ve(),m=B(),T=B(),I=B(),i=U(e,"menu"),o=b({get:()=>i.value,set:t=>{var l;i.value&&!t&&((l=T.value)!=null&&l.Î¨openChildren)||(i.value=t)}}),{items:g,transformIn:A,transformOut:F}=Te(e),a=U(e,"modelValue",[],t=>A(t===null?[null]:ye(t)),t=>{const l=F(t);return e.multiple?l:l[0]??null}),V=b(()=>typeof e.counterValue=="function"?e.counterValue(a.value):typeof e.counterValue=="number"?e.counterValue:a.value.length),C=Ve(),Z=b(()=>a.value.map(t=>t.value)),k=Q(!1),K=b(()=>o.value?e.closeText:e.openText);let O="",H;const S=b(()=>e.hideSelected?g.value.filter(t=>!a.value.some(l=>l===t)):g.value),M=b(()=>e.hideNoData&&!S.value.length||e.readonly||(C==null?void 0:C.isReadonly.value)),G=b(()=>{var t;return{...e.menuProps,activatorProps:{...((t=e.menuProps)==null?void 0:t.activatorProps)||{},"aria-haspopup":"listbox"}}}),D=B(),{onListScroll:J,onListKeydown:X}=Be(D,m);function ee(t){e.openOnClear&&(o.value=!0)}function te(){M.value||(o.value=!o.value)}function ne(t){var u,v;if(!t.key||e.readonly||C!=null&&C.isReadonly.value)return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"," "].includes(t.key)&&(o.value=!0),["Escape","Tab"].includes(t.key)&&(o.value=!1),t.key==="Home"?(u=D.value)==null||u.focus("first"):t.key==="End"&&((v=D.value)==null||v.focus("last"));const l=1e3;function c(r){const h=r.key.length===1,d=!r.ctrlKey&&!r.metaKey&&!r.altKey;return h&&d}if(e.multiple||!c(t))return;const w=performance.now();w-H>l&&(O=""),O+=t.key.toLowerCase(),H=w;const p=g.value.find(r=>r.title.toLowerCase().startsWith(O));p!==void 0&&(a.value=[p])}function R(t){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!t.props.disabled)if(e.multiple){const c=a.value.findIndex(p=>e.valueComparator(p.value,t.value)),w=l??!~c;if(~c){const p=w?[...a.value,t]:[...a.value];p.splice(c,1),a.value=p}else w&&(a.value=[...a.value,t])}else{const c=l!==!1;a.value=c?[t]:[],ge(()=>{o.value=!1})}}function le(t){var l;(l=D.value)!=null&&l.$el.contains(t.relatedTarget)||(o.value=!1)}function ae(){var t;k.value&&((t=m.value)==null||t.focus())}function oe(t){k.value=!0}function ue(t){if(t==null)a.value=[];else if(j(m.value,":autofill")||j(m.value,":-webkit-autofill")){const l=g.value.find(c=>c.title===t);l&&R(l)}else m.value&&(m.value.value="")}return E([o,a],()=>{if(!e.hideSelected&&o.value&&a.value.length){const t=S.value.findIndex(l=>a.value.some(c=>e.valueComparator(c.value,l.value)));me&&window.requestAnimationFrame(()=>{var l;t>=0&&((l=I.value)==null||l.scrollToIndex(t))})}}),E(()=>e.items,(t,l)=>{o.value||k.value&&!l.length&&t.length&&(o.value=!0)}),Ce(()=>{const t=!!(e.chips||n.chip),l=!!(!e.hideNoData||S.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),c=a.value.length>0,w=q.filterProps(e),p=c||!k.value&&e.label&&!e.persistentPlaceholder?void 0:e.placeholder;return s(q,x({ref:m},w,{modelValue:a.value.map(u=>u.props.value).join(", "),"onUpdate:modelValue":ue,focused:k.value,"onUpdate:focused":u=>k.value=u,validationValue:a.externalValue,counterValue:V.value,dirty:c,class:["v-select",{"v-select--active-menu":o.value,"v-select--chips":!!e.chips,[`v-select--${e.multiple?"multiple":"single"}`]:!0,"v-select--selected":a.value.length,"v-select--selection-slot":!!n.selection},e.class],style:e.style,inputmode:"none",placeholder:p,"onClick:clear":ee,"onMousedown:control":te,onBlur:le,onKeydown:ne,"aria-label":y(K.value),title:y(K.value)}),{...n,default:()=>s(_,null,[s(Ie,x({ref:T,modelValue:o.value,"onUpdate:modelValue":u=>o.value=u,activator:"parent",contentClass:"v-select__content",disabled:M.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ae},G.value),{default:()=>[l&&s(Ae,x({ref:D,selected:Z.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onKeydown:X,onFocusin:oe,onScrollPassive:J,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},e.listProps),{default:()=>{var u,v,r;return[(u=n["prepend-item"])==null?void 0:u.call(n),!S.value.length&&!e.hideNoData&&(((v=n["no-data"])==null?void 0:v.call(n))??s(W,{title:y(e.noDataText)},null)),s(Re,{ref:I,renderless:!0,items:S.value},{default:h=>{var $;let{item:d,index:P,itemRef:f}=h;const N=x(d.props,{ref:f,key:P,onClick:()=>R(d,null)});return(($=n.item)==null?void 0:$.call(n,{item:d,index:P,props:N}))??s(W,x(N,{role:"option"}),{prepend:ie=>{let{isSelected:se}=ie;return s(_,null,[e.multiple&&!e.hideSelected?s(ke,{key:d.value,modelValue:se,ripple:!1,tabindex:"-1"},null):void 0,d.props.prependAvatar&&s(Fe,{image:d.props.prependAvatar},null),d.props.prependIcon&&s(z,{icon:d.props.prependIcon},null)])}})}}),(r=n["append-item"])==null?void 0:r.call(n)]}})]}),a.value.map((u,v)=>{function r(f){f.stopPropagation(),f.preventDefault(),R(u,!1)}const h={"onClick:close":r,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),r(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},d=t?!!n.chip:!!n.selection,P=d?pe(t?n.chip({item:u,index:v,props:h}):n.selection({item:u,index:v})):void 0;if(!(d&&!P))return s("div",{key:u.value,class:"v-select__selection"},[t?n.chip?s(Pe,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>[P]}):s(we,x({key:"chip",closable:e.closableChips,size:"small",text:u.title,disabled:u.props.disabled},h),null):P??s("span",{class:"v-select__selection-text"},[u.title,e.multiple&&v<a.value.length-1&&s("span",{class:"v-select__selection-comma"},[he(",")])])])})]),"append-inner":function(){var h;for(var u=arguments.length,v=new Array(u),r=0;r<u;r++)v[r]=arguments[r];return s(_,null,[(h=n["append-inner"])==null?void 0:h.call(n,...v),e.menuIcon?s(z,{class:"v-select__menu-icon",icon:e.menuIcon},null):void 0])}})}),xe({isFocused:k,menu:o,select:R},m)}});export{$e as V};
