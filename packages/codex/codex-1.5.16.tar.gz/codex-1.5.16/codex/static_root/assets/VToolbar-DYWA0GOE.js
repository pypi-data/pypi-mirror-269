const __vite__fileDeps=["assets/admin-drawer-panel-BFTD31i8.js","assets/admin-drawer-panel-Cr-0BCQv.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{x as ee,bY as ke,E as ie,bL as we,bK as Se,aq as le,F as ye,G as te,I as Pe,at as ae,au as Q,bZ as Te,bP as Ce,bS as Re,s as H,y as Rt,h as _,K as oe,L as r,z as X,a$ as Ge,b_ as Vt,M as z,k as re,ax as ue,m as $,N as ce,_ as M,R as p,O as S,P as h,aD as A,ae as P,ay as q,aB as N,b$ as Ye,c0 as Bt,c1 as Dt,aa as T,ad as U,be as xt,bh as Et,c2 as It,Q as J,am as W,ak as Xe,c3 as Lt,ar as be,c4 as At,r as qe,C as Nt,c5 as $t,al as Ve,c6 as Z,bQ as Ot,c7 as Mt,bT as Ut,c8 as Ft,af as Ke,b1 as Ht,b2 as zt,ag as Ze,aX as me,c9 as Qe,ca as Wt,aC as Je,bn as et,aA as Be,aT as pe,bU as tt,cb as ot,H as De,cc as nt,l as jt,cd as Gt,ce as Yt,B as st,a as K,o as at,cf as Xt,J as rt,cg as qt,bI as Kt,ch as Zt,ci as ge,cj as Qt,av as it,bV as lt,ck as Jt,n as eo,a9 as to,bi as oo}from"./admin-drawer-panel-BFTD31i8.js";import{m as ut,b as ct,_ as dt,C as Ae,r as he,u as no,A as Ne,c as so,d as ao}from"./main-BpWFVT87.js";import{c as ro,t as io}from"./index-DUjeNg4x.js";import{V as mt,a as lo}from"./confirm-footer-DhN-8qzR.js";import{_ as gt}from"./change-password-dialog-BV_ODH9y.js";import{_ as ht,a as fe,b as uo}from"./VSlideGroup-DPSrOleH.js";import{a as co,c as mo,u as go,V as $e,d as Oe}from"./VSelectionControl-CHDbCGsK.js";const ho=ee({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...ke(),...ie(),...we(),...ut(),...Se(),...le({tag:"footer"}),...ye()},"VFooter"),ft=te()({name:"VFooter",props:ho(),setup(e,t){let{slots:o}=t;const{themeClasses:a}=Pe(e),{backgroundColorClasses:n,backgroundColorStyles:s}=ae(Q(e,"color")),{borderClasses:i}=Te(e),{elevationClasses:l}=Ce(e),{roundedClasses:k}=Re(e),v=H(32),{resizeRef:u}=Rt(b=>{b.length&&(v.value=b[0].target.clientHeight)}),g=_(()=>e.height==="auto"?v.value:parseInt(e.height,10)),{layoutItemStyles:m}=ct({id:e.name,order:_(()=>parseInt(e.order,10)),position:_(()=>"bottom"),layoutSize:g,elementSize:_(()=>e.height==="auto"?void 0:g.value),active:_(()=>e.app),absolute:Q(e,"absolute")});return oe(()=>r(e.tag,{ref:u,class:["v-footer",a.value,n.value,i.value,l.value,k.value,e.class],style:[s.value,e.app?m.value:{height:X(e.height)},e.style]},o)),{}}}),fo={name:"VersionFooter",data(){return{mdiOpenInNew:Ge,mdiContentCopy:Vt}},computed:{...z(re,{versions:e=>e.versions}),...ue($,["isUserAdmin"]),outdated:function(){return this.isUserAdmin&&this.semverGreaterThan(this.versions.latest>this.versions.installed)},versionTitle:function(){return this.outdated?`v${this.versions.latest} is available`:"up to date"}},created(){this.loadVersions()},methods:{...ce(re,["loadVersions"]),semverGreaterThan(e,t){try{if(!e||!t)return!1;const o=e.split("."),a=t.split(".");for(const[n,s]of o.entries())if(+s>+a[n])return!0}catch(o){console.debug("compare codex versions",e,">",t,o)}return!1}}},vo={id:"version"},bo={key:0,id:"latest"};function po(e,t,o,a,n,s){return p(),S(ft,{id:"version-footer",title:s.versionTitle},{default:h(()=>[A("div",vo,"codex v"+P(e.versions.installed),1),s.outdated?(p(),q("div",bo," codex v"+P(e.versions.latest)+" is available ",1)):N("",!0)]),_:1},8,["title"])}const vt=M(fo,[["render",po],["__scopeId","data-v-cd481730"]]),_o={name:"OPDSUrl",props:{title:{type:String,required:!0},subtitle:{type:String,default:void 0},url:{type:String,required:!0}},data(){return{mdiRss:Ye,showTooltip:{show:!1}}},computed:{clipBoardEnabled(){return location.protocol=="https:"},clipBoardIcon(){return this.showTooltip.show?Bt:Dt},tooltip(){return this.clipBoardEnabled}},methods:{onClickURL(){this.clipBoardEnabled&&ro(this.url,this.showTooltip)}}},ko=["title"],wo={key:0},So={class:"copied"},yo={key:0,class:"subtitle"},Po={class:"opdsUrl"};function To(e,t,o,a,n,s){return p(),q("div",{class:"opdsVersion",title:s.tooltip,onClick:t[0]||(t[0]=(...i)=>s.onClickURL&&s.onClickURL(...i))},[A("h3",null,[T(P(o.title)+" ",1),s.clipBoardEnabled?(p(),q("span",wo,[r(U,{class:"clipBoardIcon",size:"small"},{default:h(()=>[T(P(s.clipBoardIcon),1)]),_:1}),r(It,null,{default:h(()=>[xt(A("span",So,"Copied",512),[[Et,n.showTooltip.show]])]),_:1})])):N("",!0)]),o.subtitle?(p(),q("div",yo,P(o.subtitle),1)):N("",!0),A("div",Po,P(o.url),1)],8,ko)}const Co=M(_o,[["render",To],["__scopeId","data-v-68a52a66"]]),Ro={name:"OPDSDialog",components:{OPDSUrl:Co},data(){return{mdiRss:Ye,opdsV1URL:window.origin+window.CODEX.OPDS_V1_PATH,opdsV2URL:window.origin+window.CODEX.OPDS_V2_PATH}}},Vo={id:"opds"};function Bo(e,t,o,a,n,s){const i=J("OPDSUrl");return p(),S(mt,{"max-width":"30em"},{activator:h(({props:l})=>[r(Xe,W({id:"opdsButton",icon:"",size:"small",variant:"plain"},l),{default:h(()=>[r(U,null,{default:h(()=>[T(P(n.mdiRss),1)]),_:1}),T(" OPDS ")]),_:2},1040)]),default:h(()=>[A("div",Vo,[A("h2",null,[r(U,{size:"x=small",class:"inline"},{default:h(()=>[T(P(n.mdiRss),1)]),_:1}),T(" OPDS ")]),r(i,{title:"v1.2",url:n.opdsV1URL},null,8,["url"]),r(i,{title:"v2.0",url:n.opdsV2URL,subtitle:"OPDS v2 is experimental and not widely or well supported by clients"},null,8,["url"])])]),_:1})}const Do=M(Ro,[["render",Bo],["__scopeId","data-v-741734ce"]]),xo={name:"SettingsFooter",components:{OPDSDialog:Do},data(){return{mdiOpenInNew:Ge,mdiSourceRepository:Lt}},computed:{...ue($,["isCodexViewable"])}},Eo={id:"repo",href:"https://github.com/ajslater/codex",title:"Codex Source Repository",target:"_blank"};function Io(e,t,o,a,n,s){const i=J("OPDSDialog");return p(),S(ft,{id:"settingsFooter"},{default:h(()=>[e.isCodexViewable?(p(),S(i,{key:0})):N("",!0),A("a",Eo,[r(U,{id:"repoIcon",size:"x-small"},{default:h(()=>[T(P(n.mdiSourceRepository),1)]),_:1}),T(" repository"),r(U,{color:e.$vuetify.theme.current.colors.iconsInactive,size:"x-small"},{default:h(()=>[T(P(n.mdiOpenInNew),1)]),_:1},8,["color"])])]),_:1})}const bt=M(xo,[["render",Io],["__scopeId","data-v-f9eb593e"]]),Lo=ee({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...co(),...mo()},"VSwitch"),Ao=te()({name:"VSwitch",inheritAttrs:!1,props:Lo(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,t){let{attrs:o,slots:a}=t;const n=be(e,"indeterminate"),s=be(e,"modelValue"),{loaderClasses:i}=At(e),{isFocused:l,focus:k,blur:v}=go(e),u=qe(),g=_(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),m=Nt(),b=_(()=>e.id||`switch-${m}`);function C(){n.value&&(n.value=!1)}function y(x){var R,V;x.stopPropagation(),x.preventDefault(),(V=(R=u.value)==null?void 0:R.input)==null||V.click()}return oe(()=>{const[x,R]=$t(o),V=$e.filterProps(e),B=Oe.filterProps(e);return r($e,W({class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":n.value},i.value,e.class]},x,V,{modelValue:s.value,"onUpdate:modelValue":E=>s.value=E,id:b.value,focused:l.value,style:e.style}),{...a,default:E=>{let{id:d,messagesId:c,isDisabled:f,isReadonly:w,isValid:D}=E;const I={model:s,isValid:D};return r(Oe,W({ref:u},B,{modelValue:s.value,"onUpdate:modelValue":[F=>s.value=F,C],id:d.value,"aria-describedby":c.value,type:"checkbox","aria-checked":n.value?"mixed":void 0,disabled:f.value,readonly:w.value,onFocus:k,onBlur:v},R),{...a,default:F=>{let{backgroundColorClasses:j,backgroundColorStyles:O}=F;return r("div",{class:["v-switch__track",...j.value],style:O.value,onClick:y},[a["track-true"]&&r("div",{key:"prepend",class:"v-switch__track-true"},[a["track-true"](I)]),a["track-false"]&&r("div",{key:"append",class:"v-switch__track-false"},[a["track-false"](I)])])},input:F=>{let{inputNode:j,icon:O,backgroundColorClasses:ne,backgroundColorStyles:de}=F;return r(Ve,null,[j,r("div",{class:["v-switch__thumb",{"v-switch__thumb--filled":O||e.loading},e.inset?void 0:ne.value],style:e.inset?void 0:de.value},[a.thumb?r(Z,{defaults:{VIcon:{icon:O,size:"x-small"}}},{default:()=>[a.thumb({...I,icon:O})]}):r(Ot,null,{default:()=>[e.loading?r(Mt,{name:"v-switch",active:!0,color:D.value===!1?void 0:g.value},{default:G=>a.loader?a.loader(G):r(Ut,{active:G.isActive,color:G.color,indeterminate:!0,size:"16",width:"2"},null)}):O&&r(U,{key:String(O),icon:O,size:"x-small"},null)]})])])}})}})}),{}}}),No={name:"AuthLoginDialog",components:{SubmitFooter:ht},data(){return{rules:{username:[e=>!!e||"Username is required"],password:[e=>e?this.registerMode&&e.length<this.MIN_PASSWORD_LEN?`Password must be ${this.MIN_PASSWORD_LEN} characters long`:!0:"Password is required"],passwordConfirm:[e=>e===this.credentials.password||"Passwords must match"]},formModel:{},credentials:{username:"",password:"",passwordConfirm:""},submitButtonEnabled:!1,showDialog:!1,registerMode:!1,mdiLogin:Ft}},computed:{...z(re,{formErrors:e=>e.form.errors,formSuccess:e=>e.form.success}),...z($,{adminFlags:e=>e.adminFlags,MIN_PASSWORD_LEN:e=>e.MIN_PASSWORD_LEN}),submitButtonLabel:function(){return this.registerMode?"Register":"Login"}},watch:{showDialog(e){e&&(this.loadAdminFlags(),this.$refs.form&&this.$refs.form.reset())},credentials:{handler(){const e=this.$refs.form;e?e.validate().then(({valid:t})=>this.submitButtonEnabled=t).catch(console.error):this.submitButtonEnabled=!1},deep:!0}},mounted(){window.addEventListener("keyup",this._keyListener)},beforeUnmount(){window.removeEventListener("keyup",this._keyListener)},methods:{...ce($,["loadAdminFlags","login","register"]),doAuth(e){return this[e](this.credentials).then(()=>this.showDialog=this.formErrors&&this.formErrors.length>0).catch(console.error)},submit(){this.$refs.form.validate().then(({valid:t})=>{if(!t)return;const o=this.registerMode?"register":"login";return this.doAuth(o)}).catch(console.error)},_keyListener(e){e.stopImmediatePropagation()}}};function $o(e,t,o,a,n,s){const i=ht;return p(),S(mt,{modelValue:n.showDialog,"onUpdate:modelValue":t[7]||(t[7]=l=>n.showDialog=l),origin:"center-top",transition:"slide-y-transition","max-width":"20em"},{activator:h(({props:l})=>[r(Ze,Ht(zt(l)),{default:h(()=>[r(Ke,null,{default:h(()=>[r(U,null,{default:h(()=>[T(P(n.mdiLogin),1)]),_:1}),T(" Login ")]),_:1})]),_:2},1040)]),default:h(()=>[r(uo,{id:"authDialog",ref:"form"},{default:h(()=>[r(fe,{modelValue:n.credentials.username,"onUpdate:modelValue":t[0]||(t[0]=l=>n.credentials.username=l),autocomplete:"username",label:"Username",rules:n.rules.username,clearable:"",autofocus:"",onKeydown:t[1]||(t[1]=me(l=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"]),r(fe,{ref:"password",modelValue:n.credentials.password,"onUpdate:modelValue":t[2]||(t[2]=l=>n.credentials.password=l),autocomplete:n.registerMode?"new-password":"current-password",label:"Password",rules:n.rules.password,clearable:"",type:"password",onKeydown:t[3]||(t[3]=me(l=>{n.registerMode?e.$refs.passwordConfirm.focus():s.submit()},["enter"]))},null,8,["modelValue","autocomplete","rules"]),r(Qe,null,{default:h(()=>[n.registerMode?(p(),S(fe,{key:0,ref:"passwordConfirm",modelValue:n.credentials.passwordConfirm,"onUpdate:modelValue":t[4]||(t[4]=l=>n.credentials.passwordConfirm=l),autocomplete:"new-password",label:"Confirm Password",rules:n.rules.passwordConfirm,clearable:"",type:"password",onKeydown:me(s.submit,["enter"])},null,8,["modelValue","rules","onKeydown"])):N("",!0)]),_:1}),e.adminFlags.registration?(p(),S(Ao,{key:0,modelValue:n.registerMode,"onUpdate:modelValue":t[5]||(t[5]=l=>n.registerMode=l),label:"Register"},{default:h(()=>[T(" Register ")]),_:1},8,["modelValue"])):N("",!0),r(i,{verb:n.registerMode?"Register":"Login",table:"",disabled:!n.submitButtonEnabled,onSubmit:s.submit,onCancel:t[6]||(t[6]=l=>n.showDialog=!1)},null,8,["verb","disabled","onSubmit"])]),_:1},512)]),_:1},8,["modelValue"])}const Oo=M(No,[["render",$o],["__scopeId","data-v-ef06f84f"]]),Mo={name:"AuthLogoutItem",data:function(){return{mdiLogout:Wt}},computed:{...z($,{username:e=>e.user.username})},methods:{...ce($,["logout"])}};function Uo(e,t,o,a,n,s){return p(),S(Ze,{onClick:e.logout},{default:h(()=>[r(Ke,null,{default:h(()=>[r(U,null,{default:h(()=>[T(P(e.mdiLogout),1)]),_:1}),T("Logout "+P(e.username),1)]),_:1})]),_:1},8,["onClick"])}const Fo=M(Mo,[["render",Uo]]),Ho={name:"AuthMenu",components:{ChangePasswordDialog:gt,AuthLoginDialog:Oo,AuthLogoutItem:Fo},computed:{...z($,{user:e=>e.user})},methods:{...ce($,["logout"])}};function zo(e,t,o,a,n,s){const i=J("AuthLogoutItem"),l=gt,k=J("AuthLoginDialog");return p(),q(Ve,null,[e.user?(p(),S(i,{key:0})):N("",!0),e.user?(p(),S(l,{key:1,user:e.user},null,8,["user"])):(p(),S(k,{key:2}))],64)}const pt=M(Ho,[["render",zo]]),Me=Je(et(()=>dt(()=>import("./admin-drawer-panel-BFTD31i8.js").then(e=>e.dx),__vite__mapDeps([0,1])))),Wo={name:"SettingsCommonPanel",components:{AuthMenu:pt,AdminMenu:Me},props:{adminMenu:{type:Boolean,default:!0}},data(){return{AdminMenu:Me}},computed:{...ue($,["isUserAdmin"])}},jo={id:"commonPanel"};function Go(e,t,o,a,n,s){const i=pt;return p(),q("div",jo,[r(i),e.isUserAdmin?(p(),S(pe,{key:0})):N("",!0),e.isUserAdmin?(p(),S(Be(n.AdminMenu),{key:1,menu:o.adminMenu},null,8,["menu"])):N("",!0)])}const Yo=M(Wo,[["render",Go],["__scopeId","data-v-a21632a4"]]),Xo=e=>{const t=e.pk,o=ot();return e={...e,...o},delete e.pk,De.get(`c/${t}`,{params:e})},qo=()=>{const e=ot();return De.get("c/settings",{params:e})},Ko=e=>De.put("c/settings",e),In=({pk:e,mtime:t})=>`${nt(e)}/download/comic-${e}.cbz?mtime=${t}`,Ln=({pk:e,page:t,mtime:o})=>`${nt(e)}/${t}/page.jpg?mtime=${o}`,Ue=({pk:e,page:t,mtime:o})=>`${tt(e)}/${t}/page.jpg?mtime=${o}`,Zo=({pk:e,mtime:t})=>`/c/${e}/book.pdf?mtime=${t}`,ve={getPdfBookSource:Zo,getReaderBasePath:tt,getReaderInfo:Xo,getReaderSettings:qo,setReaderSettings:Ko},Qo=function(e){let t;return e?t=e.length===4&&!Number.isNaN(e)?" ("+e+")":" v"+e:t="",t},Jo=function({issueNumber:e,issueSuffix:t},o){let a;try{e==null&&!t&&(e=0);const n=Number.parseFloat(e),s=Math.floor(n);o===void 0&&(o=0),n===s?a=s.toString():(a=n.toString(),o+=a.split(".")[1].length+1),a=a.padStart(o,"0")}catch{a=""}return t&&(a+=t),a},en=function({issueNumber:e,issueSuffix:t,issueCount:o},a){let n="#"+Jo({issueNumber:e,issueSuffix:t},a);return o&&(n+=` of ${o}`),n},tn=function({seriesName:e,volumeName:t,issueNumber:o,issueSuffix:a,issueCount:n},s){const i=Qo(t),l=en({issueNumber:o,issueSuffix:a,issueCount:n},s);return[e,i,l].filter(Boolean).join(" ")},_t={fitTo:"",twoPages:null,readingDirection:"",readRtlInReverse:null};Object.freeze(_t);const kt={cacheBook:!1};Object.freeze(kt);const se=new Set(["",null,void 0]);Object.freeze(se);const wt={prev:"next",next:"prev"};Object.freeze(wt);const _e={rel:"prefetch",as:"image"};Object.freeze(_e);const xe=new Set(["ttb","btt"]);Object.freeze(xe);const St=new Set(["rtl","btt"]);Object.freeze(St);const Fe=1,yt={S:"Screen",W:"Width",H:"Height",O:"Original"};Object.freeze(yt);const on=()=>Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>600?"HEIGHT":"WIDTH",He=e=>{xe.has(e.readingDirection)&&e.twoPages&&(e.twoPages=!1)},nn=jt("reader",{state:()=>({choices:{fitTo:Ae.reader.fitTo,readingDirection:Ae.reader.readingDirection,nullValues:se},readerSettings:{fitTo:on(),twoPages:!1,readingDirection:"ltr",readRtlInReverse:!1},books:{current:void 0,prev:!1,next:!1},arcs:[],arc:{},page:void 0,routes:{prev:!1,next:!1,books:{prev:!1,next:!1}},bookChange:void 0,reactWithScroll:!1,clientSettings:{cacheBook:!1,scale:Fe}}),getters:{groupBooks(e){const t=[];return e.books.prev[0]&&t.push[e.books.prev[0]],t.push[e.books.current],e.books.next[0]&&t.push[e.books.next[0]],t},activeSettings(e){return e.getSettings(e.books.current)||{}},activeTitle(e){var a;const t=e.books.current;let o;return((a=e.arcs[0])==null?void 0:a.group)==="f"&&(o=t==null?void 0:t.filename),o||(o=t?tn(t):""),o},routeParams(e){return{pk:+e.books.current.pk,page:+e.page}},isVertical(e){return xe.has(e.activeSettings.readingDirection)},isPDF(e){var t,o;return((o=(t=e.books)==null?void 0:t.current)==null?void 0:o.fileType)=="PDF"},cacheBook(e){return e.clientSettings.cacheBook&&!(this.isPDF&&this.isVertical)},isPagesNotRoutes(e){return e.isVertical||this.cacheBook},isReadInReverse(e){return St.has(e.activeSettings.readingDirection)},isBTT(e){return e.activeSettings.readingDirection==="btt"},isFirstPage(e){return e.page===0},isLastPage(e){const t=e.books.current?e.books.current.maxPage:0,o=e.activeSettings.twoPages?1:0,a=t-o;return this.page>=a}},actions:{setReadRTLInReverse(e){return this.readerSettings.readRtlInReverse&&e.readingDirection==="rtl"?{...e,readingDirection:"ltr"}:e},getSettings(e){const t={...se};let o=e?e.settings:{};o=this.setReadRTLInReverse(o);const a=[this.readerSettings,o];for(const n of a)for(const[s,i]of Object.entries(n))se.has(i)||(t[s]=i);return He(t),t},bookChangeLocation(e){let t;return this.isBTT?t=e==="next"?"left":"right":t=e==="next"?"right":"left",t},bookChangeCursorClass(e){let t;return this.isReadInReverse?t=e==="next"?"up":"down":t=e==="next"?"down":"up",t+"Cursor"},bookChangeShow(e){return e==="prev"?this.books.prev&&this.isFirstPage:this.books.next&&this.isLastPage},bookChangeIcon(e){let t=e==="next";return this.isBTT&&(t=!t),t?Gt:Yt},isCoverPage(e,t){return e.readLtr!==!1&&t===0||e.readLtr&&t===e.maxPage},_getRouteParams(e,t,o){const a=o==="prev"?-1:1;let n=1;this.getSettings(e).twoPages&&!this.isCoverPage(e,+t+a)&&(n=2),n=n*a;const i=+t+n;let l=!1;return i>=0&&i<=e.maxPage&&(l={pk:e.pk,page:i}),l},fitToClass(e){const t=this.getSettings(e),o={};let a;if(this.clientSettings.scale>Fe?a="Orig":a=yt[t.fitTo],a){let n="fitTo";n+=io(a),this.isVertical?n+="Vertical":t.twoPages&&(n+="Two"),o[n]=!0}return o},_updateSettings(e,t){t?(this.books.current.settings={...this.books.current.settings,...e},He(this.books.current.settings)):this.readerSettings={...this.readerSettings,...e}},_getBookRoutePage(e,t){let o=0;if(t&&e.readLtr!==!1||!t&&e.readLtr===!1){const n=this.getSettings(e).twoPages?-1:0;o=e.maxPage+n}return o},_getBookRoute(e,t){if(!e)return!1;const o=this._getBookRoutePage(e,t);return{pk:e.pk,page:o}},_getBookRoutes(e,t){return{prev:this._getBookRoute(e,!0),next:this._getBookRoute(t,!1)}},async setRoutesAndBookmarkPage(e){const t=this.books.current;this.$patch(o=>{o.routes.prev=this._getRouteParams(t,e,"prev"),o.routes.next=this._getRouteParams(t,e,"next")}),await this._setBookmarkPage(e).then(()=>(this.bookChange=void 0,!0))},setActivePage(e,t=!0){if(e<0)return console.warn("Page out of bounds. Redirecting to 0."),this.routeToPage(0);if(e>this.books.current.maxPage)return console.warn(`Page out of bounds. Redirecting to ${this.books.current.maxPage}.`),this.routeToPage(this.books.current.maxPage);if(this.reactWithScroll=!!t,this.page=+e,this.setRoutesAndBookmarkPage(e),this.isPagesNotRoutes){const o={params:{pk:this.books.current.pk,page:e}},{href:a}=he.resolve(o);window.history.pushState({},void 0,a)}else window.scrollTo(0,0)},async loadReaderSettings(){return ve.getReaderSettings().then(e=>{const t=e.data;return this._updateSettings(t,!1),!0}).catch(console.error)},async loadBooks(e){await ve.getReaderInfo(e).then(t=>{const o=t.data,a=[o.books.prevBook,o.books.current,o.books.nextBook];for(const s of a)s&&!s.settings&&(s.settings={});const n=this._getBookRoutes(o.books.prevBook,o.books.nextBook);return this.$patch(s=>{s.books.current=o.books.current,s.books.prev=o.books.prevBook,s.books.next=o.books.nextBook,s.arcs=o.arcs,s.arc=o.arc,s.routes.prev=this._getRouteParams(s.books.current,e.page,"prev"),s.routes.next=this._getRouteParams(s.books.current,e.page,"next"),s.routes.books=n}),!0}).catch(t=>{console.debug(t);const o=no().page,a=o&&o.routes?o.routes.last:{name:"home"};return he.push(a)})},async _setBookmarkPage(e){const t={group:"c",pk:this.books.current.pk};e=Math.max(Math.min(this.books.current.maxPage,e),0);const o={page:e};await Ne.setGroupBookmarks(t,o)},async setSettingsLocal(e){this._updateSettings(e,!0),await Ne.setGroupBookmarks({group:"c",pk:+this.books.current.pk},this.books.current.settings)},setSettingsClient(e){this.clientSettings={...this.clientSettings,...e}},async clearSettingsLocal(){await this.setSettingsLocal(_t),this.setSettingsClient(kt)},async setSettingsGlobal(e){this._updateSettings(e,!1),await ve.setReaderSettings(this.readerSettings),await this.clearSettingsLocal()},setBookChangeFlag(e){e=this.normalizeDirection(e),this.bookChange=this.routes.books[e]?e:void 0},normalizeDirection(e){return this.isReadInReverse?wt[e]:e},_validateRoute(e,t){if(t||(t=this.books.current),!t)return{};const o=t.maxPage??0;return e.page>o?(e.page=o,console.warn("Tried to navigate past the end of the book.")):e.page<0&&(e.page=0,console.warn("Tried to navigate before the beginning of the book.")),e},_routeTo(e,t){if(e=this._validateRoute(e,t),this.isPagesNotRoutes&&+e.pk===this.books.current.pk)this.setActivePage(+e.page,!0);else{const o={name:"reader",params:e};he.push(o).catch(console.debug)}},routeToDirectionOne(e){e=this.normalizeDirection(e);const t=e==="prev"?-1:1,o=this.page+=t;if(o<0||o>this.books.current.maxPage)return;const a={pk:this.books.current.pk,page:o};this._routeTo(a)},routeToDirection(e){if(e=this.normalizeDirection(e),this.routes[e]){const t=this.routes[e];this._routeTo(t)}else this.routes.books[e]?this.bookChange===e?this._routeTo(this.routes.books[e],this.books[e]):this.setBookChangeFlag(e):console.debug("No route to direction",e)},routeToPage(e){const t={pk:this.books.current.pk,page:e};this._routeTo(t)},routeToBook(e){this._routeTo(this.routes.books[e],this.books[e])},_prefetchSrc(e,t,o=!1,a=!1){if(!e)return!1;const n=o?this.books[t]:this.books.current;if(!n)return!1;let s=e.page;if(a){if(!this.getSettings(n).twoPages)return!1;s+=1}if(s>n.maxPage)return!1;const i={pk:e.pk,page:s,mtime:n.mtime};return Ue(i)},prefetchLinks(e,t,o=!1){if(!o&&this.cacheBook)return{};const a=[this._prefetchSrc(e,t,o,!1),this._prefetchSrc(e,t,o,!0)],n=[];for(const s of a)s&&n.push({..._e,href:s});return{link:n}},prefetchBook(e){if(!this.cacheBook||e.fileType=="PDF")return{};const t=e.pk,o=[];for(let a=0;a<=e.maxPage;a++){const n={pk:t,page:a,mtime:e.mtime},s=Ue(n);s&&o.push({..._e,href:s})}return{link:o}},toRoute(e){return e?{params:e}:{}},linkLabel(e,t){return`${e==="prev"?"Previous":"Next"} ${t}`}}});function sn(e){let{rootEl:t,isSticky:o,layoutItemStyles:a}=e;const n=H(!1),s=H(0),i=_(()=>{const v=typeof n.value=="boolean"?"top":n.value;return[o.value?{top:"auto",bottom:"auto",height:void 0}:void 0,n.value?{[v]:X(s.value)}:{top:a.value.top}]});st(()=>{K(o,v=>{v?window.addEventListener("scroll",k,{passive:!0}):window.removeEventListener("scroll",k)},{immediate:!0})}),at(()=>{window.removeEventListener("scroll",k)});let l=0;function k(){const v=l>window.scrollY?"up":"down",u=t.value.getBoundingClientRect(),g=parseFloat(a.value.top??0),m=window.scrollY-Math.max(0,s.value-g),b=u.height+Math.max(s.value,g)-window.scrollY-window.innerHeight,C=parseFloat(getComputedStyle(t.value).getPropertyValue("--v-body-scroll-y"))||0;u.height<window.innerHeight-g?(n.value="top",s.value=g):v==="up"&&n.value==="bottom"||v==="down"&&n.value==="top"?(s.value=window.scrollY+u.top-C,n.value=!0):v==="down"&&b<=0?(s.value=0,n.value="bottom"):v==="up"&&m<=0&&(C?n.value!=="top"&&(s.value=-m+C+g,n.value="top"):(s.value=u.top+m,n.value="top")),l=window.scrollY}return{isStuck:n,stickyStyles:i}}const an=100,rn=20;function ze(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function We(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let t=0;for(let o=e.length-1;o>0;o--){if(e[o].t===e[o-1].t)continue;const a=ze(t),n=(e[o].d-e[o-1].d)/(e[o].t-e[o-1].t);t+=(n-a)*Math.abs(n),o===e.length-1&&(t*=.5)}return ze(t)*1e3}function ln(){const e={};function t(n){Array.from(n.changedTouches).forEach(s=>{(e[s.identifier]??(e[s.identifier]=new Xt(rn))).push([n.timeStamp,s])})}function o(n){Array.from(n.changedTouches).forEach(s=>{delete e[s.identifier]})}function a(n){var v;const s=(v=e[n])==null?void 0:v.values().reverse();if(!s)throw new Error(`No samples for touch id ${n}`);const i=s[0],l=[],k=[];for(const u of s){if(i[0]-u[0]>an)break;l.push({t:u[0],d:u[1].clientX}),k.push({t:u[0],d:u[1].clientY})}return{x:We(l),y:We(k),get direction(){const{x:u,y:g}=this,[m,b]=[Math.abs(u),Math.abs(g)];return m>b&&u>=0?"right":m>b&&u<=0?"left":b>m&&g>=0?"down":b>m&&g<=0?"up":un()}}}return{addMovement:t,endTouch:o,getVelocity:a}}function un(){throw new Error}function cn(e){let{isActive:t,isTemporary:o,width:a,touchless:n,position:s}=e;st(()=>{window.addEventListener("touchstart",R,{passive:!0}),window.addEventListener("touchmove",V,{passive:!1}),window.addEventListener("touchend",B,{passive:!0})}),at(()=>{window.removeEventListener("touchstart",R),window.removeEventListener("touchmove",V),window.removeEventListener("touchend",B)});const i=_(()=>["left","right"].includes(s.value)),{addMovement:l,endTouch:k,getVelocity:v}=ln();let u=!1;const g=H(!1),m=H(0),b=H(0);let C;function y(d,c){return(s.value==="left"?d:s.value==="right"?document.documentElement.clientWidth-d:s.value==="top"?d:s.value==="bottom"?document.documentElement.clientHeight-d:Y())-(c?a.value:0)}function x(d){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const f=s.value==="left"?(d-b.value)/a.value:s.value==="right"?(document.documentElement.clientWidth-d-b.value)/a.value:s.value==="top"?(d-b.value)/a.value:s.value==="bottom"?(document.documentElement.clientHeight-d-b.value)/a.value:Y();return c?Math.max(0,Math.min(1,f)):f}function R(d){if(n.value)return;const c=d.changedTouches[0].clientX,f=d.changedTouches[0].clientY,w=25,D=s.value==="left"?c<w:s.value==="right"?c>document.documentElement.clientWidth-w:s.value==="top"?f<w:s.value==="bottom"?f>document.documentElement.clientHeight-w:Y(),I=t.value&&(s.value==="left"?c<a.value:s.value==="right"?c>document.documentElement.clientWidth-a.value:s.value==="top"?f<a.value:s.value==="bottom"?f>document.documentElement.clientHeight-a.value:Y());(D||I||t.value&&o.value)&&(u=!0,C=[c,f],b.value=y(i.value?c:f,t.value),m.value=x(i.value?c:f),k(d),l(d))}function V(d){const c=d.changedTouches[0].clientX,f=d.changedTouches[0].clientY;if(u){if(!d.cancelable){u=!1;return}const D=Math.abs(c-C[0]),I=Math.abs(f-C[1]);(i.value?D>I&&D>3:I>D&&I>3)?(g.value=!0,u=!1):(i.value?I:D)>3&&(u=!1)}if(!g.value)return;d.preventDefault(),l(d);const w=x(i.value?c:f,!1);m.value=Math.max(0,Math.min(1,w)),w>1?b.value=y(i.value?c:f,!0):w<0&&(b.value=y(i.value?c:f,!1))}function B(d){if(u=!1,!g.value)return;l(d),g.value=!1;const c=v(d.changedTouches[0].identifier),f=Math.abs(c.x),w=Math.abs(c.y);(i.value?f>w&&f>400:w>f&&w>3)?t.value=c.direction===({left:"right",right:"left",top:"down",bottom:"up"}[s.value]||Y()):t.value=m.value>.5}const E=_(()=>g.value?{transform:s.value==="left"?`translateX(calc(-100% + ${m.value*a.value}px))`:s.value==="right"?`translateX(calc(100% - ${m.value*a.value}px))`:s.value==="top"?`translateY(calc(-100% + ${m.value*a.value}px))`:s.value==="bottom"?`translateY(calc(100% - ${m.value*a.value}px))`:Y(),transition:"none"}:void 0);return{isDragging:g,dragProgress:m,dragStyles:E}}function Y(){throw new Error}const dn=["start","end","left","right","top","bottom"],mn=ee({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>dn.includes(e)},sticky:Boolean,...ke(),...ie(),...so(),...we(),...ut(),...Se(),...le({tag:"nav"}),...ye()},"VNavigationDrawer"),gn=te()({name:"VNavigationDrawer",props:mn(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,t){let{attrs:o,emit:a,slots:n}=t;const{isRtl:s}=rt(),{themeClasses:i}=Pe(e),{borderClasses:l}=Te(e),{backgroundColorClasses:k,backgroundColorStyles:v}=ae(Q(e,"color")),{elevationClasses:u}=Ce(e),{displayClasses:g,mobile:m}=ao(e),{roundedClasses:b}=Re(e),C=qt(),y=be(e,"modelValue",null,L=>!!L),{ssrBootStyles:x}=Kt(),{scopeId:R}=lo(),V=qe(),B=H(!1),E=_(()=>e.rail&&e.expandOnHover&&B.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),d=_(()=>Zt(e.location,s.value)),c=_(()=>!e.permanent&&(m.value||e.temporary)),f=_(()=>e.sticky&&!c.value&&d.value!=="bottom");ge(()=>e.expandOnHover&&e.rail!=null,()=>{K(B,L=>a("update:rail",!L))}),ge(()=>!e.disableResizeWatcher,()=>{K(c,L=>!e.permanent&&eo(()=>y.value=!L))}),ge(()=>!e.disableRouteWatcher&&!!C,()=>{K(C.currentRoute,()=>c.value&&(y.value=!1))}),K(()=>e.permanent,L=>{L&&(y.value=!0)}),Qt(()=>{e.modelValue!=null||c.value||(y.value=e.permanent||!m.value)});const{isDragging:w,dragProgress:D,dragStyles:I}=cn({isActive:y,isTemporary:c,width:E,touchless:Q(e,"touchless"),position:d}),F=_(()=>{const L=c.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):E.value;return w.value?L*D.value:L}),{layoutItemStyles:j,layoutItemScrimStyles:O}=ct({id:e.name,order:_(()=>parseInt(e.order,10)),position:d,layoutSize:F,elementSize:E,active:_(()=>y.value||w.value),disableTransitions:_(()=>w.value),absolute:_(()=>e.absolute||f.value&&typeof ne.value!="string")}),{isStuck:ne,stickyStyles:de}=sn({rootEl:V,isSticky:f,layoutItemStyles:j}),G=ae(_(()=>typeof e.scrim=="string"?e.scrim:null)),Pt=_(()=>({...w.value?{opacity:D.value*.2,transition:"none"}:void 0,...O.value}));it({VList:{bgColor:"transparent"}});function Tt(){B.value=!0}function Ct(){B.value=!1}return oe(()=>{const L=n.image||e.image;return r(Ve,null,[r(e.tag,W({ref:V,onMouseenter:Tt,onMouseleave:Ct,class:["v-navigation-drawer",`v-navigation-drawer--${d.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":B.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":c.value,"v-navigation-drawer--active":y.value,"v-navigation-drawer--sticky":f.value},i.value,k.value,l.value,g.value,u.value,b.value,e.class],style:[v.value,j.value,I.value,x.value,de.value,e.style]},R,o),{default:()=>{var Ee,Ie,Le;return[L&&r("div",{key:"image",class:"v-navigation-drawer__img"},[n.image?r(Z,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:e.image}}},n.image):r(lt,{key:"image-img",alt:"",cover:!0,height:"inherit",src:e.image},null)]),n.prepend&&r("div",{class:"v-navigation-drawer__prepend"},[(Ee=n.prepend)==null?void 0:Ee.call(n)]),r("div",{class:"v-navigation-drawer__content"},[(Ie=n.default)==null?void 0:Ie.call(n)]),n.append&&r("div",{class:"v-navigation-drawer__append"},[(Le=n.append)==null?void 0:Le.call(n)])]}}),r(Jt,{name:"fade-transition"},{default:()=>[c.value&&(w.value||y.value)&&!!e.scrim&&r("div",W({class:["v-navigation-drawer__scrim",G.backgroundColorClasses.value],style:[Pt.value,G.backgroundColorStyles.value],onClick:()=>y.value=!1},R),null)]})])}),{isStuck:ne}}}),hn={name:"SettingsDrawer",components:{SettingsCommonPanel:Yo,SettingsFooter:bt,VersionFooter:vt},props:{title:{type:String,required:!0},panel:{type:Object,required:!0},admin:{type:Boolean,default:!1}},computed:{...ue($,["isCodexViewable"]),...to(re,["isSettingsDrawerOpen"]),...z(nn,{invisibleHack:e=>e.bookChange==="next"}),adminAndNotSmall(){return this.admin&&!this.$vuetify.display.smAndDown}},mounted(){this.isSettingsDrawerOpen=this.adminAndNotSmall}},fn={class:"settingsDrawerContainer"},vn={id:"topBlock"},bn={class:"settingsHeader"},pn={id:"footerGroup"};function _n(e,t,o,a,n,s){const i=J("SettingsCommonPanel"),l=bt,k=vt;return p(),S(gn,W(e.$attrs,{modelValue:e.isSettingsDrawerOpen,"onUpdate:modelValue":t[0]||(t[0]=v=>e.isSettingsDrawerOpen=v),"disable-resize-watcher":"","disable-route-watcher":"",location:"right",scrim:!s.adminAndNotSmall,temporary:!s.adminAndNotSmall,touchless:""}),{append:h(()=>[r(k)]),default:h(()=>[A("div",fn,[A("div",vn,[A("header",bn,[A("h3",null,P(o.title),1)]),e.isCodexViewable?(p(),S(Be(o.panel),{key:0})):N("",!0),e.isCodexViewable?(p(),S(pe,{key:1})):N("",!0),r(i,{"admin-menu":!o.admin},null,8,["admin-menu"]),r(pe)]),A("div",pn,[r(l)])])]),_:1},16,["modelValue","scrim","temporary"])}const An=M(hn,[["render",_n],["__scopeId","data-v-a38da0ea"]]),je=Je(et(()=>dt(()=>import("./admin-drawer-panel-BFTD31i8.js").then(e=>e.dy),__vite__mapDeps([0,1])))),kn={name:"SettingsDrawerButton",components:{AdminSettingsButtonProgress:je},data(){return{mdiMenu:oo,AdminSettingsButtonProgress:je}},computed:{...z($,["isUserAdmin"])}};function wn(e,t,o,a,n,s){return p(),S(Xe,W(e.$attrs,{icon:"",title:"Settings"}),{default:h(()=>[r(U,null,{default:h(()=>[T(P(n.mdiMenu),1)]),_:1}),e.isUserAdmin?(p(),S(Be(n.AdminSettingsButtonProgress),{key:0})):N("",!0)]),_:1},16)}const Nn=M(kn,[["render",wn]]),Sn=ee({text:String,...ie(),...le()},"VToolbarTitle"),yn=te()({name:"VToolbarTitle",props:Sn(),setup(e,t){let{slots:o}=t;return oe(()=>{const a=!!(o.default||o.text||e.text);return r(e.tag,{class:["v-toolbar-title",e.class],style:e.style},{default:()=>{var n;return[a&&r("div",{class:"v-toolbar-title__placeholder"},[o.text?o.text():e.text,(n=o.default)==null?void 0:n.call(o)])]}})}),{}}}),Pn=[null,"prominent","default","comfortable","compact"],Tn=ee({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>Pn.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...ke(),...ie(),...we(),...Se(),...le({tag:"header"}),...ye()},"VToolbar"),$n=te()({name:"VToolbar",props:Tn(),setup(e,t){var b;let{slots:o}=t;const{backgroundColorClasses:a,backgroundColorStyles:n}=ae(Q(e,"color")),{borderClasses:s}=Te(e),{elevationClasses:i}=Ce(e),{roundedClasses:l}=Re(e),{themeClasses:k}=Pe(e),{rtlClasses:v}=rt(),u=H(!!(e.extended||(b=o.extension)!=null&&b.call(o))),g=_(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),m=_(()=>u.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return it({VBtn:{variant:"text"}}),oe(()=>{var R;const C=!!(e.title||o.title),y=!!(o.image||e.image),x=(R=o.extension)==null?void 0:R.call(o);return u.value=!!(e.extended||x),r(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},a.value,s.value,i.value,l.value,k.value,v.value,e.class],style:[n.value,e.style]},{default:()=>[y&&r("div",{key:"image",class:"v-toolbar__image"},[o.image?r(Z,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},o.image):r(lt,{key:"image-img",cover:!0,src:e.image},null)]),r(Z,{defaults:{VTabs:{height:X(g.value)}}},{default:()=>{var V,B,E;return[r("div",{class:"v-toolbar__content",style:{height:X(g.value)}},[o.prepend&&r("div",{class:"v-toolbar__prepend"},[(V=o.prepend)==null?void 0:V.call(o)]),C&&r(yn,{key:"title",text:e.title},{text:o.title}),(B=o.default)==null?void 0:B.call(o),o.append&&r("div",{class:"v-toolbar__append"},[(E=o.append)==null?void 0:E.call(o)])])]}}),r(Z,{defaults:{VTabs:{height:X(m.value)}}},{default:()=>[r(Qe,null,{default:()=>[u.value&&r("div",{class:"v-toolbar__extension",style:{height:X(m.value)}},[x])]})]})]})}),{contentHeight:g,extensionHeight:m}}});export{Nn as S,yn as V,An as _,$n as a,en as b,Fe as c,Ue as d,gn as e,Qo as f,tn as g,In as h,Ln as i,Jo as j,nn as u};
