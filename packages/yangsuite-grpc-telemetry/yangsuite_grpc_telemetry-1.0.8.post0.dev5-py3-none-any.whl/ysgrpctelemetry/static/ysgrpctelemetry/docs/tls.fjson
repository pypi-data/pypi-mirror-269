{"parents": [{"link": "../grpc/", "title": "Configuring gRPC Telemetry Receivers"}], "prev": {"link": "../clear/", "title": "Telemetry over gRPC Clear Channel"}, "next": null, "title": "Telemetry over gRPC Secure Channel", "meta": {}, "body": "<section id=\"telemetry-over-grpc-secure-channel\">\n<h1>Telemetry over gRPC Secure Channel<a class=\"headerlink\" href=\"#telemetry-over-grpc-secure-channel\" title=\"Permalink to this heading\">\u00b6</a></h1>\n<p>To start a gRPC secure connection a server certificate and key must be\ncreated and uploaded to the device profile of the router receiving\nthe stream from.  The instructions below may not match the router exactly\nso look up the associated documentation the streaming device.</p>\n<ul>\n<li><p><strong>Create an ssl.conf file</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"p\">[</span><span class=\"n\">req</span><span class=\"p\">]</span>\n<span class=\"n\">distinguished_name</span> <span class=\"o\">=</span> <span class=\"n\">req_distinguished_name</span>\n<span class=\"n\">req_extensions</span> <span class=\"o\">=</span> <span class=\"n\">v3_req</span>\n<span class=\"p\">[</span><span class=\"n\">req_distinguished_name</span><span class=\"p\">]</span>\n<span class=\"n\">countryName</span>                 <span class=\"o\">=</span> <span class=\"n\">Country</span> <span class=\"n\">Name</span> <span class=\"p\">(</span><span class=\"mi\">2</span> <span class=\"n\">letter</span> <span class=\"n\">code</span><span class=\"p\">)</span>\n<span class=\"n\">countryName_default</span>         <span class=\"o\">=</span> <span class=\"n\">CA</span>\n<span class=\"n\">stateOrProvinceName</span>         <span class=\"o\">=</span> <span class=\"n\">State</span> <span class=\"ow\">or</span> <span class=\"n\">Province</span> <span class=\"n\">Name</span> <span class=\"p\">(</span><span class=\"n\">full</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n<span class=\"n\">stateOrProvinceName_default</span> <span class=\"o\">=</span> <span class=\"n\">Some</span><span class=\"o\">-</span><span class=\"n\">State</span>\n<span class=\"n\">localityName</span>                <span class=\"o\">=</span> <span class=\"n\">Name</span> <span class=\"p\">(</span><span class=\"n\">eg</span><span class=\"p\">,</span> <span class=\"n\">city</span><span class=\"p\">)</span>\n<span class=\"n\">localityName_default</span>        <span class=\"o\">=</span> <span class=\"n\">Kanata</span>\n<span class=\"n\">organizationName</span>            <span class=\"o\">=</span> <span class=\"n\">Organization</span> <span class=\"n\">Name</span> <span class=\"p\">(</span><span class=\"n\">eg</span><span class=\"p\">,</span> <span class=\"n\">company</span><span class=\"p\">)</span>\n<span class=\"n\">organizationName_default</span>    <span class=\"o\">=</span> <span class=\"n\">Cisco</span>\n<span class=\"n\">commonName</span>                  <span class=\"o\">=</span> <span class=\"n\">Common</span> <span class=\"n\">Name</span>\n<span class=\"n\">commonName_max</span>              <span class=\"o\">=</span> <span class=\"mi\">64</span>\n<span class=\"n\">commonName_default</span>          <span class=\"o\">=</span> <span class=\"n\">grpc</span>\n\n<span class=\"p\">[</span><span class=\"n\">v3_req</span><span class=\"p\">]</span>\n<span class=\"n\">subjectAltName</span> <span class=\"o\">=</span> <span class=\"nd\">@alt_names</span>\n\n<span class=\"p\">[</span><span class=\"n\">alt_names</span><span class=\"p\">]</span>\n<span class=\"n\">IP</span><span class=\"mf\">.1</span> <span class=\"o\">=</span> <span class=\"mf\">10.19.198.133</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>Create a Private key for certificate authority</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">openssl</span> <span class=\"n\">genrsa</span> <span class=\"o\">-</span><span class=\"n\">out</span> <span class=\"n\">myca</span><span class=\"o\">.</span><span class=\"n\">key</span> <span class=\"mi\">2048</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>Create a Private key for the receiver (yangsuite)</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">openssl</span> <span class=\"n\">genrsa</span> <span class=\"o\">-</span><span class=\"n\">out</span> <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">key</span> <span class=\"mi\">2048</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>Create the CA certificate (signs requests for receiver certificate)</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">openssl</span> <span class=\"n\">req</span> <span class=\"o\">-</span><span class=\"n\">x509</span> <span class=\"o\">-</span><span class=\"n\">new</span> <span class=\"o\">-</span><span class=\"n\">nodes</span> <span class=\"o\">-</span><span class=\"n\">key</span> <span class=\"n\">myca</span><span class=\"o\">.</span><span class=\"n\">key</span> <span class=\"o\">-</span><span class=\"n\">sha256</span> <span class=\"o\">-</span><span class=\"n\">days</span> <span class=\"mi\">365</span> <span class=\"o\">-</span><span class=\"n\">out</span> <span class=\"n\">myca</span><span class=\"o\">.</span><span class=\"n\">cert</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>Create receiver certificate request</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">openssl</span> <span class=\"n\">req</span> <span class=\"o\">-</span><span class=\"n\">out</span> <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">csr</span> <span class=\"o\">-</span><span class=\"n\">key</span> <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">key</span> <span class=\"o\">-</span><span class=\"n\">new</span> <span class=\"o\">-</span><span class=\"n\">config</span> <span class=\"o\">./</span><span class=\"n\">ssl</span><span class=\"o\">.</span><span class=\"n\">conf</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>Take receiver request and produce certificate for receiver</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">openssl</span> <span class=\"n\">x509</span> <span class=\"o\">-</span><span class=\"n\">req</span> <span class=\"o\">-</span><span class=\"ow\">in</span> <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">csr</span> <span class=\"o\">-</span><span class=\"n\">CA</span> <span class=\"n\">myca</span><span class=\"o\">.</span><span class=\"n\">cert</span> <span class=\"o\">-</span><span class=\"n\">CAkey</span> <span class=\"n\">myca</span><span class=\"o\">.</span><span class=\"n\">key</span> <span class=\"o\">-</span><span class=\"n\">CAcreateserial</span> <span class=\"o\">-</span><span class=\"n\">out</span> <span class=\"n\">server</span><span class=\"o\">.</span><span class=\"n\">cert</span> <span class=\"o\">-</span><span class=\"n\">days</span> <span class=\"mi\">365</span> <span class=\"o\">-</span><span class=\"n\">extensions</span> <span class=\"n\">v3_req</span> <span class=\"o\">-</span><span class=\"n\">extfile</span> <span class=\"o\">./</span><span class=\"n\">ssl</span><span class=\"o\">.</span><span class=\"n\">conf</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>Typical configuration for a trustpoint</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">conf</span> <span class=\"n\">t</span>\n<span class=\"n\">crypto</span> <span class=\"n\">pki</span> <span class=\"n\">trustpoint</span> <span class=\"n\">grpc</span><span class=\"o\">-</span><span class=\"n\">receiver</span>\n<span class=\"n\">enrollment</span> <span class=\"n\">terminal</span>\n<span class=\"n\">chain</span><span class=\"o\">-</span><span class=\"n\">validation</span> <span class=\"n\">stop</span>\n<span class=\"n\">revocation</span><span class=\"o\">-</span><span class=\"n\">check</span>  <span class=\"n\">none</span>\n<span class=\"n\">exit</span>\n<span class=\"n\">crypto</span> <span class=\"n\">pki</span> <span class=\"n\">authenticate</span> <span class=\"n\">grpc</span><span class=\"o\">-</span><span class=\"n\">receiver</span>\n</pre></div>\n</div>\n</li>\n<li><p><strong>PASTE IN: contents of myca.cert</strong></p></li>\n<li><p><strong>Typical telemetry configuration (set protocol to grpc-tls)</strong>:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">telemetry</span> <span class=\"n\">ietf</span> <span class=\"n\">subscription</span> <span class=\"mi\">222</span>\n <span class=\"n\">encoding</span> <span class=\"n\">encode</span><span class=\"o\">-</span><span class=\"n\">kvgpb</span>\n <span class=\"nb\">filter</span> <span class=\"n\">xpath</span> <span class=\"o\">/</span><span class=\"n\">process</span><span class=\"o\">-</span><span class=\"n\">cpu</span><span class=\"o\">-</span><span class=\"n\">ios</span><span class=\"o\">-</span><span class=\"n\">xe</span><span class=\"o\">-</span><span class=\"n\">oper</span><span class=\"p\">:</span><span class=\"n\">cpu</span><span class=\"o\">-</span><span class=\"n\">usage</span><span class=\"o\">/</span><span class=\"n\">cpu</span><span class=\"o\">-</span><span class=\"n\">utilization</span><span class=\"o\">/</span><span class=\"n\">five</span><span class=\"o\">-</span><span class=\"n\">seconds</span>\n <span class=\"n\">source</span><span class=\"o\">-</span><span class=\"n\">address</span> <span class=\"mf\">172.27.255.22</span>\n <span class=\"n\">source</span><span class=\"o\">-</span><span class=\"n\">vrf</span> <span class=\"n\">Mgmt</span><span class=\"o\">-</span><span class=\"n\">vrf</span>\n <span class=\"n\">stream</span> <span class=\"n\">yang</span><span class=\"o\">-</span><span class=\"n\">push</span>\n <span class=\"n\">update</span><span class=\"o\">-</span><span class=\"n\">policy</span> <span class=\"n\">periodic</span> <span class=\"mi\">2000</span>\n <span class=\"n\">receiver</span> <span class=\"n\">ip</span> <span class=\"n\">address</span> <span class=\"mf\">10.10.10.10</span> <span class=\"mi\">50070</span> <span class=\"n\">protocol</span> <span class=\"n\">grpc</span><span class=\"o\">-</span><span class=\"n\">tls</span> <span class=\"n\">profile</span> <span class=\"n\">myca</span>\n</pre></div>\n</div>\n</li>\n</ul>\n<section id=\"upload-server-certificate-and-key-to-device-profile\">\n<h2>Upload server certificate and key to device Profile<a class=\"headerlink\" href=\"#upload-server-certificate-and-key-to-device-profile\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Go to the \u201cSetup \u2013&gt; Device profile\u201d page from the main menu.  Select the configured device\nprofile of the router you will receive the TLS Telemetry stream from and upload server.cert\nfile to the \u201cTLS Server Certificate\u201d field and the server.key to the \u201cTLS Server Key\u201d field.</p>\n</section>\n<section id=\"starting-the-tls-secure-channel-receiver\">\n<h2>Starting the TLS secure channel receiver<a class=\"headerlink\" href=\"#starting-the-tls-secure-channel-receiver\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>On the YANG Suite page, enter the IP address and TCP port the stream will come in on and\ncheck the checkbox labeled \u201c(Optional) TLS receiver\u201d.  A dialog box will pop up asking you\nto choose the device profile where you uploaded the server certificate and key to.\nClick on \u201cStart TLS telemetry receiver\u201d.</p>\n<img alt=\"Screenshot showing tls dialog box.\" src=\"../_images/tls.png\" />\n</section>\n<section id=\"managing-receiver-start-stop-and-output\">\n<h2>Managing receiver start/stop and output<a class=\"headerlink\" href=\"#managing-receiver-start-stop-and-output\" title=\"Permalink to this heading\">\u00b6</a></h2>\n<p>Click on \u201cManage receiver\u201d to see what receivers are live on the YANG Suite\nserver.  By default, all telemetry messages are sent to the YANG Suite web page.\nThere are also choices to send the output to a file and/or a running instance of Elasticsearch.\nFor file output, enter the full path of the file targeted for output.  The directory\nmust exist, however, the file will be created if it does not exist or appeded if it does.\nTo send the output to [Elasticsearch], enter the URI where it is running.\nClick on \u201cSet output(s)\u201d to begin optional output target.\nClick on the \u201cStop\u201d button next to the receiver you wish to stop.</p>\n<p>[Elasticsearch]:<a class=\"reference external\" href=\"https://www.elastic.co/\">https://www.elastic.co/</a></p>\n<img alt=\"Screenshot of show/stop dialog box\" src=\"../_images/stop.png\" />\n</section>\n</section>\n", "metatags": "<meta name=\"generator\" content=\"Docutils 0.19: https://docutils.sourceforge.io/\" />\n", "rellinks": [["genindex", "General Index", "I", "index"], ["clear", "Telemetry over gRPC Clear Channel", "P", "previous"]], "sourcename": "tls.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Telemetry over gRPC Secure Channel</a><ul>\n<li><a class=\"reference internal\" href=\"#upload-server-certificate-and-key-to-device-profile\">Upload server certificate and key to device Profile</a></li>\n<li><a class=\"reference internal\" href=\"#starting-the-tls-secure-channel-receiver\">Starting the TLS secure channel receiver</a></li>\n<li><a class=\"reference internal\" href=\"#managing-receiver-start-stop-and-output\">Managing receiver start/stop and output</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "tls", "sidebars": ["about.html", "navigation.html", "relations.html", "searchbox.html", "donate.html"], "customsidebar": null, "alabaster_version": "0.7.13"}