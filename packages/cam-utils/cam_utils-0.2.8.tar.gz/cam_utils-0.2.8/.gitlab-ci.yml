stages:
    - tests
    - lint
    - deploy

unit-tests:
    stage: tests
    image: python:3.12-slim-bookworm
    only:
        refs:
            - main
    script:
        - pip install --upgrade pip
        - pip install pytest
        - pytest -v

linting:
    stage: lint
    image: python:3.12-slim-bookworm
    only:
        refs:
            - main
    script:
        - pip install --upgrade pip
        - pip install ruff
        - ruff check

upload-to-pypi:
    stage: deploy
    image: python:3.12-slim-bookworm
    only:
        refs:
            - main
    script:
        - python -m pip install --upgrade build
        - python -m build
        - python -m pip install --upgrade twine
        - python -m twine upload dist/*
