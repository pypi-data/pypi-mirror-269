(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{41010:function(e,t,r){Promise.resolve().then(r.bind(r,48837))},30695:function(e,t,r){"use strict";r.d(t,{_i:function(){return i},gz:function(){return l},hw:function(){return s},sj:function(){return o},wG:function(){return n}});var a=r(20357);async function n(e,t){var r;let{arg:n}=t,i=await fetch((null!==(r=a.env.NEXT_PUBLIC_API_SERVER)&&void 0!==r?r:"")+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!(i.status>=200&&i.status<300))throw Error(await i.text());let o=await i.json();if(!i.ok)throw Error(o.message);return o}let i=async function(){for(var e,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];let i=await fetch((null!==(e=a.env.NEXT_PUBLIC_API_SERVER)&&void 0!==e?e:"")+r[0],r[1]);if(!i.ok)throw Error(await i.text());return i.json()},o=async(e,t)=>{var r;let n=await fetch((null!==(r=a.env.NEXT_PUBLIC_API_SERVER)&&void 0!==r?r:"")+e,t);if(!n.ok)throw Error(await n.text());return n};async function s(e,t){var r;let{arg:n}=t,i=await fetch("".concat(null!==(r=a.env.NEXT_PUBLIC_API_SERVER)&&void 0!==r?r:"").concat(e,"/").concat(n),{method:"DELETE"});if(!i.ok)throw Error(await i.text());return i}async function l(e,t){var r;let{arg:n}=t,i=await fetch("".concat(null!==(r=a.env.NEXT_PUBLIC_API_SERVER)&&void 0!==r?r:"").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw Error(await i.text());return i}},12951:function(e,t,r){"use strict";r.d(t,{Bf:function(){return s},JB:function(){return l},ZP:function(){return o}});var a=r(91617),n=r(30695),i=r(2265);function o(){let{data:e,error:t,isLoading:r}=(0,a.ZP)("/v1/streamers",n._i);return{isLoading:r,streamers:e}}function s(){let{data:e,error:t,isLoading:r}=(0,a.ZP)("/v1/users",n._i),[o,s]=(0,i.useState)([]);return(0,i.useEffect)(()=>{if(!e||0===e.length)return;let t=async e=>{try{let t=await (0,n._i)("/bili/space/myinfo?user=".concat(e.value),void 0),r=await (0,n.sj)("/bili/proxy?url=".concat(t.data.face)),a=await r.blob();return{...e,name:t.data.name,face:URL.createObjectURL(a)}}catch(a){console.error(a);let t=await (0,n.sj)("/bili/proxy?url=https://i0.hdslb.com/bfs/face/member/noface.jpg"),r=await t.blob();return{...e,name:"Cookie已失效",face:URL.createObjectURL(r)}}};Promise.all(e.map(t)).then(s)},[e]),{isLoading:r,isError:t,biliUsers:o}}function l(){var e;let{data:t,error:r,isLoading:i}=(0,a.ZP)("/bili/archive/pre",n._i);return{isLoading:i,isError:r,typeTree:null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.typelist.map(e=>({label:e.name,value:e.id,children:e.children}))}}},48837:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var a=r(57437),n=r(49339),i=r(71834),o=r(44261),s=r(98964),l=r(2265),c=r(87138),d=r(37617),u=r(85080),h=r(88684),m=r(30695),x=r(91617),f=r(16463),g=r(36710),v=r(56164),y=r.n(v),p=e=>{let{abbr:t,label:r,value:i,onRemove:o,url:s}=e;return(0,a.jsxs)("div",{className:y().components,children:[(0,a.jsx)(n.qE,{size:"small",src:s,children:t}),(0,a.jsxs)("div",{className:y().info,children:[(0,a.jsx)("div",{className:y().name,children:r}),(0,a.jsx)("div",{className:y().email,children:i})]}),(0,a.jsx)(n.gn,{title:"确定是否要删除？",content:"此操作将不可逆",onConfirm:o,children:(0,a.jsx)(n.zx,{className:y()["semi-icon-close"],type:"danger",theme:"borderless",icon:(0,a.jsx)(g.Z,{})})})]},r)},j=r(77634),b=r(12951),w=r(57171),_=r(20357),C=e=>{let{onSuccess:t}=e,[r,i]=(0,l.useState)("");return((0,l.useEffect)(()=>{let e=new AbortController,r=e.signal;return r.addEventListener("abort",()=>{console.log("aborted!")}),(async()=>{var e;let a=await (0,m._i)("/v1/get_qrcode",void 0);i(a.data.url),console.log(a.data.url);let n=await fetch("".concat(null!==(e=_.env.NEXT_PUBLIC_API_SERVER)&&void 0!==e?e:"","/v1/login_by_qrcode"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),signal:r});if(!(n.status>=200&&n.status<300))throw Error(await n.text());let o=await n.json();if(!n.ok)throw Error(o.message);t(o.filename)})().catch(e=>{console.log(e),n.P_.error({title:"QRcode",content:(0,a.jsx)(n.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}})}),()=>{e.abort("qrcode exit")}},[]),""===r)?(0,a.jsx)(n.yC,{}):(0,a.jsx)("div",{style:{marginTop:30,marginLeft:"auto",marginRight:"auto",width:"max-content"},children:(0,a.jsx)(w.tv,{value:r})})},E=e=>{let{onCancel:t,visible:r}=e,{trigger:i}=(0,j.Z)("/v1/users",m.wG),{trigger:o}=(0,j.Z)("/v1/users",m.hw),{biliUsers:c}=(0,b.Bf)(),[d,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!1),f=async e=>{x(!0);try{let t=await (0,m._i)("/bili/space/myinfo?user=".concat(e),void 0);if(t.code)throw Error(t.message);await i({id:0,name:e,value:e,platform:"bilibili-cookies"}),u(!1),n.FN.success("创建成功")}catch(t){let e=t.message;try{e=JSON.parse(e).error}catch(e){console.log(e)}return n.P_.error({title:"创建失败",content:(0,a.jsx)(n.Typography.Paragraph,{style:{maxWidth:450},children:e}),style:{width:"min-content"}})}finally{x(!1)}},g=async()=>{var e;let t=await (null===(e=y.current)||void 0===e?void 0:e.validate());await f(null==t?void 0:t.value)},v=async e=>{try{await o(e),n.FN.success("删除成功")}catch(e){n.P_.error({title:"删除失败",content:(0,a.jsx)(n.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}})}},y=(0,l.useRef)(),[w,_]=(0,l.useState)(),[E,P]=(0,l.useState)((0,a.jsx)(a.Fragment,{}));return(0,a.jsxs)(n.Uu,{title:(0,a.jsx)(n.Typography.Title,{heading:4,children:"用户管理"}),visible:r,footer:(0,a.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,a.jsx)(n.zx,{onClick:()=>{u(!0)},icon:(0,a.jsx)(s.Z,{size:"large"}),style:{marginRight:4,backgroundColor:"rgba(var(--semi-indigo-0), 1)"},children:"新增"})}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},onCancel:t,children:[(0,a.jsx)(n.aV,{className:"component-list-demo-booklist",dataSource:c,split:!1,size:"small",style:{flexBasis:"100%",flexShrink:0},renderItem:e=>(0,a.jsx)(p,{url:e.face,abbr:e.name,label:e.name,value:e.value,onRemove:async()=>await v(e.id)})}),(0,a.jsxs)(n.u_,{title:"新建",visible:d,onOk:g,afterClose:()=>{console.log("After Close callback executed")},onCancel:()=>{u(!1),console.log("Cancel button clicked")},closeOnEsc:!0,confirmLoading:h,okButtonProps:{disabled:2===w},bodyStyle:{overflow:"auto",maxHeight:"calc(100vh - 320px)",paddingLeft:10,paddingRight:10},children:[(0,a.jsx)(n.X2,{type:"flex",justify:"center",children:(0,a.jsxs)(n.FX,{type:"button",buttonSize:"large",onChange:e=>{_(e.target.value),2===e.target.value&&P((0,a.jsx)(C,{onSuccess:f})),1===e.target.value&&P((0,a.jsx)(n.Form,{getFormApi:e=>y.current=e,children:(0,a.jsx)(n.Form.Input,{field:"value",label:"Cookie路径",trigger:"blur",placeholder:"cookies.json",rules:[{required:!0}]})}))},value:w,children:[(0,a.jsx)(n.Y8,{value:1,children:"cookie文件"}),(0,a.jsx)(n.Y8,{value:2,children:"扫码登录"})]})}),(0,a.jsx)(n.X2,{children:E})]})]})};function P(){let{Meta:e}=n.Card,{Header:t,Content:r}=n.Layout,[g,v]=(0,l.useState)(!1),y=(0,f.useRouter)(),{trigger:p}=(0,j.Z)("/v1/upload/streamers",m.hw),{data:w,error:_,isLoading:C}=(0,x.ZP)("/v1/upload/streamers",m._i),{biliUsers:P}=(0,b.Bf)(),k=()=>{v(!g)},R=async e=>{await p(e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E,{visible:g,onCancel:k}),(0,a.jsx)(t,{style:{backgroundColor:"var(--semi-color-bg-1)"},children:(0,a.jsx)(n.JL,{header:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{backgroundColor:"rgba(var(--semi-violet-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",display:"flex",padding:"6px"},children:(0,a.jsx)(i.Z,{size:"large"})}),(0,a.jsx)("h4",{style:{marginLeft:"12px"},children:"投稿管理"})]}),mode:"horizontal",footer:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.zx,{onClick:k,type:"tertiary",icon:(0,a.jsx)(o.Z,{}),style:{borderRadius:"var(--semi-border-radius-circle)",marginRight:"12px"}}),(0,a.jsx)(c.default,{href:"/upload-manager/add",onClick:e=>{0===P.length&&(e.preventDefault(),k(),n.P_.info({title:"用户列表为空",position:"top",content:"请先在右侧点击新增用户",duration:3}))},children:(0,a.jsx)(n.zx,{icon:(0,a.jsx)(s.Z,{}),theme:"solid",style:{marginRight:10},children:"新建"})})]})})}),(0,a.jsx)(r,{style:{padding:"24px",backgroundColor:"var(--semi-color-bg-0)"},children:(0,a.jsx)(n.aV,{grid:{gutter:12,xs:24,sm:24,md:12,lg:8,xl:6,xxl:4},dataSource:w,renderItem:t=>(0,a.jsx)(n.aV.Item,{children:(0,a.jsxs)(n.Card,{shadows:"hover",style:{maxWidth:360,margin:"8px 2px",flexGrow:1},bodyStyle:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsx)(e,{title:t.template_name}),(0,a.jsxs)(n.hE,{theme:"borderless",children:[(0,a.jsx)(n.zx,{icon:(0,a.jsx)(d.Z,{})}),(0,a.jsx)(n.zx,{icon:(0,a.jsx)(u.Z,{}),onClick:()=>{y.push("/upload-manager/edit?id=".concat(t.id))}}),(0,a.jsx)(n.gn,{title:"确定是否要删除？",content:"此操作将不可逆",margin:50,onConfirm:async()=>await R(t.id),children:(0,a.jsx)(n.zx,{theme:"borderless",icon:(0,a.jsx)(h.Z,{})})})]})]})})})})]})}},56164:function(e){e.exports={components:"AvatarCard_components__heTwn","semi-icon-close":"AvatarCard_semi-icon-close__9hwya",info:"AvatarCard_info__Gzwh8",name:"AvatarCard_name__mOADG",email:"AvatarCard_email__ncXyR"}}},function(e){e.O(0,[798,674,86,949,753,834,460,862,954,339,617,781,589,425,971,23,744],function(){return e(e.s=41010)}),_N_E=e.O()}]);