(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[795],{4474:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/architype",function(){return t(1517)}])},1517:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return O}});var s=t(5893),i=t(9876),n=t(1017),a=t(1232),l=t(9236),o=t(7841),d=t(50),c=t(579),u=t(9604),h=function(e){let{editor:r}=e,{editorValue:t,handleEditorBeforeMount:i,handleEditorChange:n}=r;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(u.ZP,{height:"600px",beforeMount:i,theme:"vs-dark",value:t,onChange:n,defaultLanguage:"jac",defaultPath:"inmemory://jac.json"})})},p=t(6373),x=t(5945),m=t(8228),g=t(208),j=function(e,r){let t=(0,x.NL)();return(0,m.D)({mutationFn(e){let{code:r,snt:t}=e,s=window.btoa(r);return g.L.post("/js/architype_register",{code:s,snt:t,encoded:"true"}).then(e=>e.data)},onSuccess(s){if(t.invalidateQueries(["architypes"]),s.success)r(),(0,p.c0)({id:"architype-registered",title:"Architype registered",message:"Your architype has been registered successfully",color:"green"});else if(s.errors&&!s.stack_trace){let i=function(e){let r=[];return e.map(e=>{let[t,s]=e.split(" ")[2].trim().split(":"),i=e.split(" - ")[2];r.push({line:Number(t),column:Number(s),message:i})}),r}(s.errors);console.log(i),i.forEach(r=>{e({lineNumber:r.line,message:r.message,endColumn:r.column,startColumn:r.column})})}}})},k=t(7294);RegExp("^\\s*#region\\b"),RegExp("^\\s*#endregion\\b");let b={defaultToken:"",tokenPostfix:".jac",keywords:["False","None","True","and","as","assert","async","await","break","class","continue","can","walker","node","edge","graph","del","elif","else","except","exec","finally","for","from","global","if","import","in","is","lambda","nonlocal","not","or","pass","print","raise","return","has","spawn","take","try","while","with","yield","disengage","int","float","long","complex","hex","abs","all","any","apply","basestring","bin","bool","buffer","bytearray","callable","chr","classmethod","cmp","coerce","compile","complex","delattr","dict","dir","divmod","enumerate","eval","execfile","file","filter","format","frozenset","getattr","globals","hasattr","hash","help","id","input","intern","isinstance","issubclass","iter","len","locals","list","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","reversed","range","raw_input","reduce","reload","repr","reversed","round","self","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","unichr","unicode","vars","xrange","zip","__dict__","__methods__","__members__","__class__","__bases__","__name__","__mro__","__subclasses__","__init__","__import__"],builtins:["report"],brackets:[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.bracket"},{open:"(",close:")",token:"delimiter.parenthesis"}],operators:["=","??","||","&&","|","^","&","==","!=","<=",">=","<<","+","-","*","/","%","!","~","++","--","+=","-=","*=","/=","%=","&=","|=","^=","<<=",">>=",">>","=>","-->","<--","->","<-"],symbols:/[=><!~?:&|+\-*\/\^%]+/,tokenizer:{root:[{include:"@whitespace"},{include:"@numbers"},[/[,:;]/,"delimiter"],[/[{}\[\]()]/,"@brackets"],[/@[a-zA-Z_]\w*/,"tag"],[/[a-zA-Z_]\w*/,{cases:{"@keywords":"keyword","@builtins":"keyword","@default":"identifier"}}]],whitespace:[[/\s+/,"white"],[/(^#.*$)/,"comment"],[/(^\/\/.*$)/,"comment"],[/'''/,"string","@endDocString"],[/"""/,"string","@endDblDocString"]],endDocString:[[/[^']+/,"string"],[/\\'/,"string"],[/'''/,"string","@popall"],[/'/,"string"]],endDblDocString:[[/[^"]+/,"string"],[/\\"/,"string"],[/"""/,"string","@popall"],[/"/,"string"]],numbers:[[/-?0x([abcdef]|[ABCDEF]|\d)+[lL]?/,"number.hex"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?[jJ]?[lL]?/,"number"]],strings:[[/'$/,"string.escape","@popall"],[/'/,"string.escape","@stringBody"],[/"$/,"string.escape","@popall"],[/"/,"string.escape","@dblStringBody"]],stringBody:[[/[^\\']+$/,"string","@popall"],[/[^\\']+/,"string"],[/\\./,"string"],[/'/,"string.escape","@popall"],[/\\$/,"string"]],dblStringBody:[[/[^\\"]+$/,"string","@popall"],[/[^\\"]+/,"string"],[/\\./,"string"],[/"/,"string.escape","@popall"],[/\\$/,"string"]]}};var f=t(1503),v=t(4523),y=t(4777),_=t(7860),w=t(9737),C=t(7564),z=t(5117),S=t(7789),E=t(7577),N=t(8393),M=t(9834),D=t(3991),L=t(7484),A=t.n(L);function R(e){let{architype:r,removeArchitype:t,setEditorValue:l,onRunWalker:d}=e,[c,u]=(0,k.useState)(!1),h=()=>{var e,t;let s=null===(e=JSON.parse(r.code_ir))||void 0===e?void 0:null===(t=e.ir)||void 0===t?void 0:t.src;l(s)};return(0,s.jsxs)(n.Z,{withBorder:!0,sx:{position:"relative"},onClick(){},children:[(0,s.jsxs)(a.Z,{position:"apart",align:"start",children:[(0,s.jsxs)(i.k,{gap:"xs",align:"center",mb:"xs",children:[(0,s.jsx)(z.x,{size:"sm",children:r.name}),(0,s.jsx)(S.C,{size:"xs",children:r.kind})]}),c&&(0,s.jsx)(E.a,{opacity:.8,color:"#000",zIndex:5}),c&&(0,s.jsxs)(v.x,{sx:{position:"absolute",zIndex:6,width:"75%",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[(0,s.jsx)(z.x,{sx:{color:"#fff"},children:"Delete this architype?"}),(0,s.jsxs)(a.Z,{position:"apart",children:[(0,s.jsx)(o.z,{size:"xs",onClick:()=>t(r.jid),children:"Yes"}),(0,s.jsx)(o.z,{size:"xs",onClick:()=>u(!1),children:"No"})]})]})]}),(0,s.jsxs)(a.Z,{position:"apart",align:"center",children:[(0,s.jsx)(z.x,{color:"dimmed",size:"xs",children:A()(r.j_timestamp).format("DD/MM/YYYY HH:mm:ss A")}),(0,s.jsxs)(a.Z,{children:["walker"===r.kind&&(0,s.jsx)(N.u,{label:"Run Walker",children:(0,s.jsx)(M.A,{color:"blue",variant:"light",size:"xs",onClick:d,children:(0,s.jsx)(D.I3n,{})})}),(0,s.jsx)(N.u,{label:"View Code",children:(0,s.jsx)(M.A,{color:"teal",variant:"light",size:"xs",onClick:()=>h(),children:(0,s.jsx)(D.seM,{})})}),(0,s.jsx)(N.u,{label:"Delete Architype",children:(0,s.jsx)(M.A,{color:"red",variant:"light",size:"xs",onClick:()=>u(!0),children:(0,s.jsx)(D.IT9,{})})})]})]})]})}var Z=function(e){let{setEditorValue:r,architypes:t,loading:i,setFilter:n,onRunWalker:a}=e,o=(0,x.NL)(),{mutate:d}=(0,m.D)(e=>g.L.post("/js/architype_delete",{arch:e}).then(e=>e.data),{onSuccess(){o.invalidateQueries(["architypes"])}});return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(v.x,{sx:e=>({width:"100%",height:"100%",overflowY:"auto",background:"dark"===e.colorScheme?e.colors.dark[7]:"#f5f5f5"}),px:"md",py:"md",children:[(0,s.jsx)(l.D,{order:5,mb:"md",children:"All Architypes"}),(0,s.jsx)(y.i,{}),(0,s.jsx)(_.s,{data:[{label:"All",value:"all"},{label:"Nodes",value:"node"},{label:"Walkers",value:"walker"},{label:"Edges",value:"edge"}],onChange:e=>n(e)}),(0,s.jsx)(y.i,{mb:"md"}),(0,s.jsxs)(v.x,{sx:{overflow:"scroll",height:"500px",position:"relative"},children:[(0,s.jsx)(w.f,{visible:i}),(0,s.jsx)(C.K,{p:"xs","data-testid":"architype-cards",children:null==t?void 0:t.map(e=>(0,s.jsx)(R,{onRunWalker(){a(e.name)},setEditorValue:r,architype:e,removeArchitype:d},e.jid))})]})]})})},P=function(e){let{filter:r}=e;return(0,f.a)(["architypes",r],()=>g.L.post("/js/architype_list",{kind:"all"===r?void 0:r,detailed:!0}).then(e=>e.data))},T=t(9669),B=t(7328),Y=t(61),F=t(1358),I=t(5044),W=t(345),$=function(e){var r;let{walkers:t,walker:i,setWalker:n}=e,[l,d]=(0,k.useState)("{}"),[c,u]=(0,k.useState)(!1),[h,p]=(0,k.useState)(null),{mutate:x,data:j,isLoading:b}=(0,m.D)({async mutationFn(e){let r=await g.L.post("/js/walker_run",{name:e.walker,nd:e.nd,ctx:{...e.payload||{}}});return r.data}});return(0,s.jsxs)("div",{children:[(0,s.jsx)(T.q,{label:"Enter Payload",placeholder:"Enter payload to run walker",validationError:"Invalid json",formatOnBlur:!0,autosize:!0,minRows:4,autoCorrect:"off",autoCapitalize:"off",autoComplete:"off",value:l,onChange(e){d(e)}}),(0,s.jsx)(B.X,{label:"Run on node",my:"sm",onChange(e){u(e.currentTarget.checked)}}),c&&(0,s.jsx)(Y.o,{label:"Node ID",placeholder:"Enter node to run walker",value:h,onChange:e=>p(e.currentTarget.value)}),(0,s.jsxs)(a.Z,{position:"apart",my:"sm",children:[(0,s.jsx)(F.Ph,{label:"Walker",placeholder:"Pick a walker to run",searchable:!0,value:i,onChange:e=>n(e),data:null===(r=t||[])||void 0===r?void 0:r.map(e=>e.name),sx:{minWidth:"300px"},"data-testid":"walker-select"}),(0,s.jsx)(o.z,{loading:b,onClick:function(){x({payload:JSON.parse(l||"{}"),walker:i,nd:h})},mt:"md",color:"teal",size:"xs",disabled:!i,children:"Run Now"})]}),(0,s.jsxs)(v.x,{sx:e=>({background:"dark"===e.colorScheme?e.colors.dark[7]:e.colors.gray[2],border:"1px solid "+e.colorScheme=="dark"?e.colors.dark[5]:e.colors.gray[5],borderRadius:8,minHeight:"300px",maxHeight:"400px",overflowY:"scroll"}),px:"md",py:"xs",my:"lg","data-testid":"result",children:[(0,s.jsxs)(a.Z,{spacing:"xs",mb:"sm",children:[(0,s.jsx)(z.x,{weight:"bold",children:"Result "}),(null==j?void 0:j.success)?(0,s.jsx)(I.k,{color:"green",size:"sm",radius:"xl",children:(0,s.jsx)(D.q4I,{size:14})}):(0,s.jsx)(I.k,{color:"red",size:"sm",radius:"xl",children:(0,s.jsx)(D.s3j,{size:14})})]}),(0,s.jsx)(y.i,{}),(0,s.jsx)(W.p,{language:"json",children:j?JSON.stringify(j,null,2):"Run a walker to see the result"})]})]})},O=function(){let e=function(){let e=(0,k.useRef)(null),[r,t]=(0,k.useState)(""),s=(e,r)=>{t(null!=e?e:"")},i=()=>{var r;let t=null===(r=e.current)||void 0===r?void 0:r.editor.getModel("inmemory://jac.json");e.current.editor.setModelMarkers(t,"jac",[])},n=r=>{let{startColumn:t,lineNumber:s,message:i}=r;if(e.current){var n,a;let l=[],o=null===(n=e.current)||void 0===n?void 0:n.editor.getModel("inmemory://jac.json");l.push({severity:null===(a=e.current)||void 0===a?void 0:a.MarkerSeverity.Error,startLineNumber:s,startColumn:t,endLineNumber:s,endColumn:t,message:i}),e.current.editor.setModelMarkers(o,"jac",l)}};return{handleEditorBeforeMount:function(r){let t=r.Uri.parse("inmemory://jac.json"),s=r.editor.createModel("// write your jac code here","jac",t);s.onDidChangeContent(e=>{r.editor.getModelMarkers({}).forEach(t=>{t.severity===r.MarkerSeverity.Error&&"jac"===t.owner&&t.startLineNumber===e.changes[0].range.startLineNumber&&r.editor.setModelMarkers(s,"jac",[])})}),r.languages.register({id:"jac"}),r.languages.setMonarchTokensProvider("jac",b),r.editor.setModelLanguage(s,"jac"),e.current=r},handleEditorChange:s,highlightError:n,hideErrors:i,setEditorValue:t,editorValue:r}}(),{data:r}=(0,f.a)({queryKey:["activeSentinel"],queryFn:()=>g.L.post("/js/sentinel_active_get").then(e=>e.data)}),{mutate:t}=j(e.highlightError,e.hideErrors),{editorValue:u,setEditorValue:p}=e,[x,m]=(0,k.useState)(null),[v,y]=(0,k.useState)("editor"),[_,w]=(0,k.useState)("all"),{data:C,isLoading:z}=P({filter:_}),{data:S,isLoading:E}=P({filter:"walker"});return(0,s.jsx)("div",{children:(0,s.jsx)(i.k,{justify:"center",align:"center",children:(0,s.jsxs)(n.Z,{w:"90%",h:"90vh",withBorder:!0,shadow:"md",radius:"md",sx:{margin:"0 auto",overflowY:"scroll"},p:30,children:[(0,s.jsxs)(a.Z,{position:"apart",align:"start",children:[(0,s.jsx)(l.D,{order:3,mb:"xl",children:"Architypes"}),(0,s.jsx)(o.z,{onClick:()=>t({code:u,snt:r.jid}),disabled:!(null==r?void 0:r.jid),children:"Register Architype"})]}),(0,s.jsxs)(d.r,{sx:{height:"600px"},children:[(0,s.jsx)(d.r.Col,{span:5,children:(0,s.jsx)(Z,{architypes:C,loading:z,setFilter:w,onRunWalker(e){m(e),y("run_walker")},setEditorValue(e){y("editor"),p(e)}})}),(0,s.jsx)(d.r.Col,{span:7,children:(0,s.jsxs)(c.m,{value:v,onTabChange:e=>y(e),children:[(0,s.jsxs)(c.m.List,{children:[(0,s.jsx)(c.m.Tab,{value:"editor",icon:(0,s.jsx)(D.c4x,{size:14}),children:"Editor"}),(0,s.jsx)(c.m.Tab,{value:"run_walker",icon:(0,s.jsx)(D.I3n,{size:14}),children:"Run Walker"})]}),(0,s.jsx)(c.m.Panel,{value:"editor",pt:"xs",children:(0,s.jsx)(h,{editor:e})}),(0,s.jsx)(c.m.Panel,{value:"run_walker",pt:"xs",sx:{height:"100%"},children:(0,s.jsx)($,{walker:x,setWalker:m,walkers:S})})]})})]})]})})})}}},function(e){e.O(0,[289,76,358,707,774,888,179],function(){return e(e.s=4474)}),_N_E=e.O()}]);