/**
 * Copyright 2024 Huawei Technologies Co., Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
#ifndef TUNE_REPO_MATMUL_TABLE_H
#define TUNE_REPO_MATMUL_TABLE_H

#include "tune_repo/utils.h"

static const int SMALL_M_MARK = -1;

/// The key and value of this map are arranged in the following format.
/// - key: {b_shape, m_shape, k_shape, n_shape, trans_a, trans_b, inDtype, outDtype}
/// - value : {m0, n0, k0, mLoop, nLoop, kLoop, coreLoop, blockDim, swizzlCount, swizzlDirect}
static REPO tlmTuneConfig910B4{
  {{1, 1, 1024, 50257, 0, 1, 2, 2}, {64, 256, 256, 1, 197, 4, 197, 20, 14, 1}},
  {{1, 4, 1024, 1024, 0, 1, 2, 2}, {16, 64, 256, 1, 16, 4, 16, 16, 4, 0}},
  {{1, 4, 1024, 1536, 0, 1, 2, 2}, {16, 128, 256, 1, 12, 4, 12, 12, 1, 1}},
  {{1, 4, 1024, 4864, 0, 1, 2, 2}, {16, 128, 512, 1, 38, 2, 38, 20, 77, 0}},
  {{1, 4, 1024, 50257, 0, 1, 2, 2}, {64, 256, 256, 1, 197, 4, 197, 20, 16, 0}},
  {{1, 4, 4864, 1024, 0, 1, 2, 2}, {16, 80, 1280, 1, 13, 4, 13, 13, 6, 0}},
  {{1, 512, 1024, 4864, 0, 1, 2, 2}, {128, 256, 256, 4, 19, 4, 76, 20, 8, 0}},
};

static REPO tlmTuneConfig910B2{
  {{1, 1, 1024, 50257, 0, 1, 2, 2}, {112, 320, 256, 1, 158, 4, 158, 24, 14, 1}},
  {{1, 4, 1024, 1024, 0, 1, 2, 2}, {16, 128, 256, 1, 8, 4, 8, 8, 1, 1}},
  {{1, 4, 1024, 1536, 0, 1, 2, 2}, {64, 128, 512, 1, 12, 2, 12, 12, 4, 0}},
  {{1, 4, 1024, 4864, 0, 1, 2, 2}, {64, 64, 512, 1, 76, 2, 76, 24, 12, 0}},
  {{1, 4, 4864, 1024, 0, 1, 2, 2}, {16, 64, 1536, 1, 16, 4, 16, 16, 16, 1}},
  {{1, 512, 1024, 1536, 0, 1, 2, 2}, {128, 256, 256, 4, 6, 4, 24, 24, 6464, 1}},
  {{1, 512, 1024, 4864, 0, 1, 2, 2}, {128, 256, 256, 4, 19, 4, 76, 24, 5, 0}},

  // 01.18 shape
  {{1, 1, 11264, 136960, 0, 1, 2, 2}, {16, 48, 1024, 1, 2854, 11, 2854, 24, 16, 1}},
  {{1, 1024, 11264, 1664, 0, 1, 2, 2}, {128, 112, 512, 8, 15, 22, 120, 24, 7, 1}},
  {{1, 1024, 11264, 6912, 0, 1, 2, 2}, {256, 128, 256, 4, 54, 44, 216, 24, 37, 0}},
  {{1, 1024, 1408, 11264, 0, 1, 2, 2}, {256, 128, 256, 4, 88, 6, 352, 24, 5, 0}},
  {{1, 1024, 6912, 11264, 0, 1, 2, 2}, {256, 128, 256, 4, 88, 27, 352, 24, 4, 0}},
  {{1, 4, 11264, 136960, 0, 1, 2, 2}, {16, 112, 1024, 1, 1223, 11, 1223, 24, 8, 1}},
  {{1, 4, 11264, 1664, 0, 1, 2, 2}, {16, 72, 1024, 1, 24, 11, 24, 24, 4, 1}},
  {{1, 4, 11264, 6912, 0, 1, 2, 2}, {16, 96, 1024, 1, 72, 11, 72, 24, 8, 1}},
  {{1, 4, 1408, 11264, 0, 1, 2, 2}, {16, 160, 512, 1, 71, 3, 71, 24, 8, 0}},
  {{1, 4, 6912, 11264, 0, 1, 2, 2}, {16, 96, 1024, 1, 118, 7, 118, 24, 169, 1}},
};

static REPO MatMulQkvTuneConfig910B2{
  // prefill key: seqlen, k, n0, n1, n2, ta, tb, in_type, out_type
  {{1024, 11264, 1408, 128, 128, 0, 1, 1, 1}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{1024, 11264, 1408, 128, 128, 0, 1, 27, 27}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{2048, 11264, 1408, 128, 128, 0, 1, 1, 1}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{2048, 11264, 1408, 128, 128, 0, 1, 27, 27}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{4096, 11264, 1408, 128, 128, 0, 1, 1, 1}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{4096, 11264, 1408, 128, 128, 0, 1, 27, 27}, {4, 5, 256, 256, 128, 256, 64, 128}},

  // infer key: batch, k, n0, n1, n2, ta, tb, in_type, out_type
  {{SMALL_M_MARK, 11264, 1408, 128, 128, 0, 1, 1, 1}, {1, 13, SMALL_M_MARK, 256, 128, SMALL_M_MARK, 64, 128}},
  {{SMALL_M_MARK, 11264, 1408, 128, 128, 0, 1, 27, 27}, {1, 13, SMALL_M_MARK, 256, 128, SMALL_M_MARK, 64, 128}},
};

static REPO MatMulQkvTuneConfig910B4{
  // prefill key: seqlen, k, n0, n1, n2, ta, tb, in_type, out_type
  {{1024, 11264, 1408, 128, 128, 0, 1, 1, 1}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{1024, 11264, 1408, 128, 128, 0, 1, 27, 27}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{2048, 11264, 1408, 128, 128, 0, 1, 1, 1}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{2048, 11264, 1408, 128, 128, 0, 1, 27, 27}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{4096, 11264, 1408, 128, 128, 0, 1, 1, 1}, {4, 5, 256, 256, 128, 256, 64, 128}},
  {{4096, 11264, 1408, 128, 128, 0, 1, 27, 27}, {4, 5, 256, 256, 128, 256, 64, 128}},

  // infer key: batch, k, n0, n1, n2, ta, tb, in_type, out_type
  {{SMALL_M_MARK, 11264, 1408, 128, 128, 0, 1, 1, 1}, {1, 13, SMALL_M_MARK, 256, 128, SMALL_M_MARK, 64, 128}},
  {{SMALL_M_MARK, 11264, 1408, 128, 128, 0, 1, 27, 27}, {1, 13, SMALL_M_MARK, 256, 128, SMALL_M_MARK, 64, 128}},
};

#endif  // TUNE_REPO_MATMUL_TABLE_H
