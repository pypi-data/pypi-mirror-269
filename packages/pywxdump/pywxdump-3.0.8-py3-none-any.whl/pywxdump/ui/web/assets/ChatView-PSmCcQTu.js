import{d as M,r as m,o as Y,a as x,b as o,c,e,f as n,w as te,g as _,h,i as U,t as k,j as E,F as G,E as J,_ as O,u as L,k as X,l as le,m as I,n as Z,p as A,q as N,s as ne,v as B,x as F,y as K,z as oe}from"./index-VdcdRmrH.js";import{h as T}from"./axios--FnjuHWf.js";/* empty css                                                                       */import{_ as se}from"./HomeView.vue_vue_type_script_setup_true_lang-dZI7DIut.js";const ae={style:{padding:"10px 10px"}},ie={key:0},re={key:1},ce=e("br",null,null,-1),de={key:2,style:{color:"#909399","font-size":"12px"}},ue=M({__name:"ContactsList",emits:["wxid"],setup(t,{emit:i}){const l=m([]),a=async()=>{try{return await T.post("/api/recent_user_list",{})}catch(d){return console.error("Error fetching data:",d),[]}},s=async(d="")=>{try{return await T.post("/api/user_list",{word:d})}catch(g){return console.error("Error fetching data:",g),[]}};Y(async()=>{try{l.value=await a()}catch(d){return console.error("Error fetching data:",d),[]}});const p=m(""),u=async()=>{try{if(p.value===""){l.value=await a();return}l.value=await s(p.value)}catch(d){return console.error("Error fetching data:",d),[]}},v=i,w=d=>{d!==void 0&&v("wxid",d.wxid)};return(d,g)=>{const D=x("el-input"),y=x("el-button"),q=x("el-avatar"),j=x("el-table-column"),H=x("el-table");return o(),c("div",null,[e("div",ae,[n(D,{placeholder:"请输入关键字",modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=V=>p.value=V),onKeyup:te(u,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),n(y,{type:"primary",onClick:u,style:{width:"50px"}},{default:_(()=>[h("搜索")]),_:1})]),n(H,{data:l.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:w},{default:_(()=>[n(j,{width:"57"},{default:_(({row:V})=>[V.headImgUrl!==""?(o(),U(q,{key:0,size:33,src:"/api/imgsrc/"+V.headImgUrl},null,8,["src"])):(o(),U(q,{key:1,size:33},{default:_(()=>[h(" 群聊 ")]),_:1}))]),_:1}),n(j,{width:"190"},{default:_(({row:V})=>[V.remark!==null&&V.remark!==""?(o(),c("span",ie,k(V.remark),1)):(o(),c("span",re,k(V.nickname),1)),ce,V.LastReadedCreateTime!==void 0&&V.LastReadedCreateTime!==null?(o(),c("span",de,k(V.LastReadedCreateTime),1)):E("",!0)]),_:1})]),_:1},8,["data"])])}}}),_e=M({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},emits:["exporting"],setup(t,{emit:i}){const l=m(!1),a=async()=>{if(l.value){console.log("正在获取实时消息，请稍后再试!");return}l.value=!0;try{const v=await T.post("/api/realtimemsg",{});return l.value=!1,J({title:"Success",message:"获取实时消息成功!",type:"success"}),v}catch(v){return l.value=!1,J({title:"Error",message:"获取实时消息失败!",type:"error"}),console.error("Error fetching data:",v),[]}},s=m(!1),r=i,p=()=>{r("exporting",!0),s.value=!0},u=()=>{r("exporting",!1),s.value=!1};return(v,w)=>{const d=x("el-text"),g=x("el-col"),D=x("el-row");return o(),c(G,null,[n(D,{gutter:5,style:{width:"100%"}},{default:_(()=>[n(g,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"label_color mx-1",truncated:""},{default:_(()=>[h("wxid:")]),_:1}),h("  "),n(d,{class:"data_color mx-1",truncated:"",title:t.userData.wxid},{default:_(()=>[h(k(t.userData.wxid),1)]),_:1},8,["title"])]),_:1}),n(g,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"label_color mx-1",truncated:""},{default:_(()=>[h("账号:")]),_:1}),h("  "),n(d,{class:"data_color mx-1",truncated:"",title:t.userData.account},{default:_(()=>[h(k(t.userData.account),1)]),_:1},8,["title"])]),_:1}),n(g,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"label_color mx-1",truncated:""},{default:_(()=>[h("昵称:")]),_:1}),h("  "),n(d,{class:"data_color mx-1",truncated:"",title:t.userData.nickname},{default:_(()=>[h(k(t.userData.nickname),1)]),_:1},8,["title"])]),_:1}),n(g,{span:6,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"label_color mx-1",truncated:""},{default:_(()=>[h("备注:")]),_:1}),h("  "),n(d,{class:"data_color mx-1",truncated:"",title:t.userData.remark},{default:_(()=>[h(k(t.userData.remark),1)]),_:1},8,["title"])]),_:1})]),_:1}),n(D,{gutter:5,style:{width:"100%"}},{default:_(()=>[n(g,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"label_color mx-1",truncated:""},{default:_(()=>[h("数量:")]),_:1}),h("  "),n(d,{class:"data_color mx-1",truncated:"",title:t.userData.msg_count},{default:_(()=>[h(k(t.userData.msg_count),1)]),_:1},8,["title"])]),_:1}),n(g,{span:15,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"label_color mx-1",truncated:""},{default:_(()=>[h("描述:")]),_:1}),h("  "),n(d,{class:"data_color mx-1",truncated:"",title:t.userData.describe},{default:_(()=>[h(k(t.userData.describe),1)]),_:1},8,["title"])]),_:1}),n(g,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[n(d,{class:"button_color mx-1 underline",truncated:"",onClick:w[0]||(w[0]=y=>{a()})},{default:_(()=>[h("实时消息 "),l.value?(o(),c(G,{key:0},[h("(获取中)")],64)):E("",!0)]),_:1})]),_:1}),n(g,{span:3,style:{"white-space":"nowrap"}},{default:_(()=>[s.value?E("",!0):(o(),U(d,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:w[1]||(w[1]=y=>{p()})},{default:_(()=>[h("导出备份")]),_:1})),s.value?(o(),U(d,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:w[2]||(w[2]=y=>{u()})},{default:_(()=>[h("聊天查看")]),_:1})):E("",!0)]),_:1})]),_:1})],64)}}}),pe=O(_e,[["__scopeId","data-v-0c9eea5d"]]),ve={class:"chat-content"},he={key:0,class:"word"},me=["src"],fe={class:"info"},ye={class:"time"},xe=["innerHTML"],we={key:1,class:"word-my"},ge={class:"info"},be={class:"time"},$e=["innerHTML"],ke=["src"],Se=M({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const i=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,a)=>(o(),c("div",ve,[t.is_sender?(o(),c("div",we,[e("div",ge,[e("p",be,k(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,$e)]),e("img",{src:t.headUrl},null,8,ke)])):(o(),c("div",he,[e("img",{src:t.headUrl},null,8,me),e("div",fe,[e("p",ye,k(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,xe)])]))]))}}),Ve=O(Se,[["__scopeId","data-v-d930be9e"]]),Ue={class:"chat-content"},Me={key:0,class:"word"},Ee=["src"],Ce={class:"info"},Te={class:"time"},De={class:"demo-image__preview"},qe={key:1,class:"word-my"},ze={class:"info"},Re={class:"time"},je={class:"demo-image__preview"},He=["src"],Ie=M({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(i,l)=>{const a=x("el-image");return o(),c("div",Ue,[t.is_sender?(o(),c("div",qe,[e("div",ze,[e("p",Re,k(t.direction),1),e("div",je,[n(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,He)])):(o(),c("div",Me,[e("img",{src:t.headUrl},null,8,Ee),e("div",Ce,[e("p",Te,k(t.direction),1),e("div",De,[n(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Oe=O(Ie,[["__scopeId","data-v-24d6aaa0"]]),Le={class:"chat-content"},Ne={key:0,class:"word"},Be=["src"],Fe={class:"info"},Ae={class:"time"},Pe={class:"demo-video__preview"},We={controls:"",width:"30%"},Ke=["src"],Ge={key:1,class:"word-my"},Ye={class:"info"},Je={class:"time"},Xe={class:"demo-video__preview"},Qe={controls:"",width:"50%"},Ze=["src"],et=["src"],tt=M({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(i,l)=>(o(),c("div",Le,[t.is_sender?(o(),c("div",Ge,[e("div",Ye,[e("p",Je,k(t.direction),1),e("div",Xe,[e("video",Qe,[e("source",{src:t.src,type:"video/mp4"},null,8,Ze)])])]),e("img",{src:t.headUrl},null,8,et)])):(o(),c("div",Ne,[e("img",{src:t.headUrl},null,8,Be),e("div",Fe,[e("p",Ae,k(t.direction),1),e("div",Pe,[e("video",We,[e("source",{src:t.src,type:"video/mp4"},null,8,Ke)])])])]))]))}}),lt=O(tt,[["__scopeId","data-v-5aa79515"]]),nt={class:"chat-content"},ot={key:0,class:"word"},st=["src"],at={class:"info"},it={class:"time"},rt={controls:"",style:{"background-color":"#fff"}},ct=["src"],dt={key:1,class:"word-my"},ut={class:"info"},_t={class:"time"},pt={controls:"",style:{"background-color":"#95EC69"}},vt=["src"],ht=["src"],mt=M({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(i,l)=>(o(),c("div",nt,[t.is_sender?(o(),c("div",dt,[e("div",ut,[e("p",_t,k(t.direction),1),e("audio",pt,[e("source",{src:t.src,type:"audio/wav"},null,8,vt)]),n(L(X),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,ht)])):(o(),c("div",ot,[e("img",{src:t.headUrl},null,8,st),e("div",at,[e("p",it,k(t.direction),1),e("audio",rt,[e("source",{src:t.src,type:"audio/wav"},null,8,ct)]),n(L(X),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),ft=O(mt,[["__scopeId","data-v-0d0f2cd4"]]),yt={class:"chat-content"},xt={key:0,class:"word"},wt=["src"],gt={class:"info"},bt={class:"time"},$t={style:{float:"left"}},kt=["href"],St={key:1,class:"word-my"},Vt={class:"info"},Ut={class:"time"},Mt={style:{float:"right"}},Et=["href"],Ct=["src"],Tt=M({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const i=t,l=m(""),a=le({file_name:String,file_size:Number,file_size_unit:String});Y(async()=>{console.log("文件加载中");const r=await s(i.src);a.file_name=r.file_name,a.file_size=Number(r.file_size)/1024,a.file_size<1024?a.file_size_unit="kb":(a.file_size=a.file_size/1024,a.file_size_unit="mb"),a.file_size=Number(r.file_size)/1024,l.value=`/api/file/${i.src}`});const s=async r=>{try{return await T.post("/api/file_info",{file_path:r})}catch(p){return console.error("Error fetching file_info:",p),""}};return(r,p)=>{const u=x("el-card");return o(),c("div",yt,[t.is_sender?(o(),c("div",St,[e("div",Vt,[e("p",Ut,k(t.direction),1),e("div",Mt,[n(u,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[h("文件 ： "),e("a",{href:l.value,download:""},k(a.file_name),9,Et),e("div",null,[h(" 文件大小："),e("span",null,k(a.file_size)+k(a.file_size_unit),1)])]),_:1})])]),e("img",{src:t.headUrl},null,8,Ct)])):(o(),c("div",xt,[e("img",{src:t.headUrl},null,8,wt),e("div",gt,[e("p",bt,k(t.direction),1),e("div",$t,[n(u,{shadow:"hover",style:{width:"fit-content"}},{default:_(()=>[h("文件 ： "),e("a",{href:l.value,download:""},k(a.file_name),9,kt),e("div",null,[h(" 文件大小："),e("span",null,k(a.file_size)+k(a.file_size_unit),1)])]),_:1})])])]))])}}}),Dt=O(Tt,[["__scopeId","data-v-e797f204"]]),qt={class:"chat-content"},zt={key:0,class:"word"},Rt=["src"],jt={class:"info"},Ht={class:"time"},It={class:"demo-image__preview"},Ot={key:1,class:"word-my"},Lt={class:"info"},Nt={class:"time"},Bt={class:"demo-image__preview"},Ft=["src"],At=M({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(i,l)=>{const a=x("el-image");return o(),c("div",qt,[t.is_sender?(o(),c("div",Ot,[e("div",Lt,[e("p",Nt,k(t.direction),1),e("div",Bt,[n(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Ft)])):(o(),c("div",zt,[e("img",{src:t.headUrl},null,8,Rt),e("div",jt,[e("p",Ht,k(t.direction),1),e("div",It,[n(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Pt=O(At,[["__scopeId","data-v-ad34c109"]]),Wt={class:"chat-content"},Kt={key:0,class:"word"},Gt=["src"],Yt={class:"info"},Jt={class:"time"},Xt=["innerHTML"],Qt={key:1,class:"word-my"},Zt={class:"info"},el={class:"time"},tl=["innerHTML"],ll=["src"],nl=M({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const i=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,a)=>(o(),c("div",Wt,[t.is_sender?(o(),c("div",Qt,[e("div",Zt,[e("p",el,k(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,tl)]),e("img",{src:t.headUrl},null,8,ll)])):(o(),c("div",Kt,[e("img",{src:t.headUrl},null,8,Gt),e("div",Yt,[e("p",Jt,k(t.direction),1),e("div",{class:"info-content",innerHTML:i(t.content)},null,8,Xt)])]))]))}}),ol=O(nl,[["__scopeId","data-v-e529325a"]]),sl={id:"chat"},al={class:"chat_body"},il={class:"chat_window",ref:"chatWindow"},rl={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},cl=M({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(t,{expose:i}){const l=t,a=m([]),s=m({}),r=m(!1),p=m(""),u=m(0),v=m(100),w=m(0),d=m(!1),g=async($,z,C)=>{if(r.value){console.log("正在获取消息，请稍后再试!");return}if(C==""){console.log("wxid 为空, 请检查!");return}try{r.value=!0,$<0&&($=0);const f=await T.post("/api/msgs",{start:$,limit:z,wxid:C});return a.value=f.msg_list,s.value=Object.assign(s.value,f.user_list),r.value=!1,f}catch(f){return r.value=!1,console.error("Error fetching data:",f),[]}},D=async $=>{try{return(await T.post("/api/msg_count",{wxid:$}))[$]}catch(z){return console.error("Error fetching data msg_count:",z),[]}},y=async()=>{try{return(await T.get("/api/mywxid")).my_wxid}catch($){return console.error("Error fetching data my_wxid:",$),[]}},q=async()=>{try{p.value=await y(),w.value=await D(l.userData.wxid),u.value=w.value-v.value,u.value<0&&(u.value=0),await g(u.value,v.value,l.userData.wxid),d.value||await A(()=>{l.setScrollTop(),d.value=!1})}catch($){return console.error("Error fetching data:",$),[]}};I(()=>l.userData.wxid,($,z)=>{console.log("username changed： ",z,$),a.value=[],s.value={},d.value=!1,w.value=0,u.value=0,q()});const j=async()=>{p.value=await y(),w.value=await D(l.userData.wxid);let $=v.value,z=u.value-$;z<0&&(z=0);const C=await g(z,$,l.userData.wxid);u.value=z,console.log("loadMore",z,u.value,$,l.userData.wxid),a.value=C.msg_list.concat(a.value),a.value.sort((f,S)=>f.id-S.id),a.value=a.value.filter((f,S,b)=>S===0||f.id!==b[S-1].id),s.value=Object.assign(s.value,C.user_list),await A(()=>{l.updateScrollTop()})};i({loadMore:j});const H=$=>($.talker=="我"&&($.talker=p.value),`${(C=>s.value.hasOwnProperty(C.talker)?s.value[C.talker].remark?s.value[C.talker].remark:s.value[C.talker].nickname?s.value[C.talker].nickname:s.value[C.talker].account?s.value[C.talker].account:C.talker:C.talker)($)} [${$.type_name}] ${$.CreateTime}`),V=$=>($.talker=="我"&&($.talker=p.value),s.value.hasOwnProperty($.talker)?"/api/imgsrc/"+s.value[$.talker].headImgUrl:"");return($,z)=>{const C=x("el-button");return o(),c("div",sl,[e("div",al,[e("div",il,[a.value.length<w.value?(o(),c("div",rl,[n(C,{type:"primary",onClick:j},{default:_(()=>[h("查看更多消息")]),_:1})])):E("",!0),(o(!0),c(G,null,Z(a.value,(f,S)=>(o(),c("div",{class:"message",key:S},[f.type_name=="文本"?(o(),U(Ve,{key:0,is_sender:f.is_sender,direction:H(f),headUrl:V(f),content:f.content.msg},null,8,["is_sender","direction","headUrl","content"])):f.type_name=="图片"?(o(),U(Oe,{key:1,is_sender:f.is_sender,direction:H(f),headUrl:V(f),src:"/api/img/"+f.content.src},null,8,["is_sender","direction","headUrl","src"])):f.type_name=="动画表情"?(o(),U(Pt,{key:2,is_sender:f.is_sender,direction:H(f),headUrl:V(f),src:"/api/imgsrc/"+f.content.src},null,8,["is_sender","direction","headUrl","src"])):f.type_name=="视频"?(o(),U(lt,{key:3,is_sender:f.is_sender,direction:H(f),headUrl:V(f),src:"/api/video/"+f.content.src},null,8,["is_sender","direction","headUrl","src"])):f.type_name=="文件"?(o(),U(Dt,{key:4,is_sender:f.is_sender,direction:H(f),headUrl:V(f),src:f.content.src},null,8,["is_sender","direction","headUrl","src"])):f.type_name=="语音"?(o(),U(ft,{key:5,is_sender:f.is_sender,direction:H(f),headUrl:V(f),src:"/api/"+f.content.src,msg:f.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(o(),U(ol,{key:6,is_sender:f.is_sender,direction:H(f),headUrl:V(f),content:f.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),dl=O(cl,[["__scopeId","data-v-49e80cb1"]]),ul=e("br",null,null,-1),_l=e("br",null,null,-1),pl={style:{position:"relative"}},vl=M({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(r,p)=>{console.log(r)});const l=m(""),a=m(""),s=async()=>{a.value="请求中...";try{a.value=await T.post("/api/export_endb",{wx_path:l.value})}catch(r){return console.error("Error fetching data msg_count:",r),a.value=`请求失败
`+r,[]}};return(r,p)=>{const u=x("el-input"),v=x("el-button"),w=x("el-divider");return o(),c("div",null,[h(" 微信文件夹路径(可选)： "),n(u,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=d=>l.value=d),style:{width:"70%"}},null,8,["modelValue"]),ul,_l,e("div",pl,[n(v,{type:"primary",onClick:p[1]||(p[1]=d=>s())},{default:_(()=>[h("导出")]),_:1})]),n(w),n(u,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=d=>a.value=d),style:{width:"100%"}},null,8,["modelValue"])])}}}),hl=e("br",null,null,-1),ml=e("br",null,null,-1),fl=e("br",null,null,-1),yl=e("br",null,null,-1),xl={style:{position:"relative"}},wl=M({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(p,u)=>{console.log(p)});const l=m(""),a=m(""),s=m(""),r=async()=>{s.value="正在处理中...";try{s.value=await T.post("/api/export_dedb",{key:a.value,wx_path:l.value})}catch(p){return console.error("Error fetching data msg_count:",p),s.value=`请求失败
`+p,[]}};return(p,u)=>{const v=x("el-input"),w=x("el-button"),d=x("el-divider");return o(),c("div",null,[h(" 密钥(可选)： "),n(v,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=g=>a.value=g),style:{width:"75%"}},null,8,["modelValue"]),hl,ml,h(" 微信文件夹路径(可选)： "),n(v,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:l.value,"onUpdate:modelValue":u[1]||(u[1]=g=>l.value=g),style:{width:"70%"}},null,8,["modelValue"]),fl,yl,e("div",xl,[n(w,{type:"primary",onClick:u[2]||(u[2]=g=>r())},{default:_(()=>[h("导出")]),_:1})]),n(d),n(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:s.value,"onUpdate:modelValue":u[3]||(u[3]=g=>s.value=g),style:{width:"100%"}},null,8,["modelValue"])])}}}),gl={style:{position:"relative"}},bl=M({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(s,r)=>{console.log(s)});const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await T.post("/api/export_csv",{wxid:i.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),l.value=`请求失败
`+s,[]}};return(s,r)=>{const p=x("el-button"),u=x("el-divider"),v=x("el-input");return o(),c("div",null,[e("div",gl,[n(p,{type:"primary",onClick:r[0]||(r[0]=w=>a())},{default:_(()=>[h("导出")]),_:1})]),n(u),n(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),$l={style:{position:"relative"}},kl=M({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(s,r)=>{console.log(s)}),m([]);const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await T.post("/api/export_json",{wxid:i.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),l.value=`请求失败
`+s,[]}};return(s,r)=>{const p=x("el-button"),u=x("el-divider"),v=x("el-input");return o(),c("div",null,[e("div",$l,[n(p,{type:"primary",onClick:r[0]||(r[0]=w=>a())},{default:_(()=>[h("导出")]),_:1})]),n(u),n(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),Sl={style:{position:"relative"}},Vl=M({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(s,r)=>{console.log(s)}),m([]);const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await T.post("/api/export_html",{wxid:i.wxid})}catch(s){return console.error("Error fetching data msg_count:",s),l.value=`请求失败
`+s,[]}};return(s,r)=>{const p=x("el-button"),u=x("el-divider"),v=x("el-input");return o(),c("div",null,[e("div",Sl,[n(p,{type:"primary",onClick:r[0]||(r[0]=w=>a())},{default:_(()=>[h("导出")]),_:1})]),n(u),n(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),Ul=e("br",null,null,-1),Ml=M({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(a,s)=>{console.log(a)});const l=()=>{console.log("requestExport")};return(a,s)=>{const r=x("el-button");return o(),c("div",null,[e("span",null,k(i.wxid),1),Ul,n(r,{type:"primary",onClick:s[0]||(s[0]=p=>l())},{default:_(()=>[h("导出")]),_:1})])}}}),El=e("br",null,null,-1),Cl=M({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(a,s)=>{console.log(a)});const l=()=>{console.log("requestExport")};return(a,s)=>{const r=x("el-button");return o(),c("div",null,[e("span",null,k(i.wxid),1),El,n(r,{type:"primary",onClick:s[0]||(s[0]=p=>l())},{default:_(()=>[h("导出")]),_:1})])}}}),Tl={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},Dl={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},ql={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},zl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Rl={style:{"margin-top":"20px"}},jl=e("br",null,null,-1),Hl=e("br",null,null,-1),Il={key:0},Ol=M({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(t){const i=t;I(()=>i.wxid,(s,r)=>{console.log(s)});const l=m("");m("");const a={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(s,r)=>{const p=x("el-option"),u=x("el-select"),v=x("el-divider"),w=x("el-main");return o(),c("div",Tl,[n(w,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:_(()=>[e("div",Dl,[e("div",ql,[zl,e("div",Rl,[h(" 导出类型: "),n(u,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=d=>l.value=d)},{default:_(()=>[(o(),c(G,null,Z(a,(d,g)=>n(p,{label:d.brief,value:g,key:g},{default:_(()=>[h(k(d.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),jl,Hl,l.value?(o(),c("span",Il,k(a[l.value].detail),1)):E("",!0)]),n(v),l.value=="endb"?(o(),U(vl,{key:0,wxid:i.wxid},null,8,["wxid"])):E("",!0),l.value=="dedb"?(o(),U(wl,{key:1,wxid:i.wxid},null,8,["wxid"])):E("",!0),l.value=="csv"?(o(),U(bl,{key:2,wxid:i.wxid},null,8,["wxid"])):E("",!0),l.value=="json"?(o(),U(kl,{key:3,wxid:i.wxid},null,8,["wxid"])):E("",!0),l.value=="html"?(o(),U(Vl,{key:4,wxid:i.wxid},null,8,["wxid"])):E("",!0),l.value=="pdf"?(o(),U(Ml,{key:5,wxid:i.wxid},null,8,["wxid"])):E("",!0),l.value=="docx"?(o(),U(Cl,{key:6,wxid:i.wxid},null,8,["wxid"])):E("",!0)])])]),_:1})])}}}),Ll=M({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(t){const i=m(null),l=m(null);m(0);const a=m(0),s=()=>{A(()=>{if(i.value){const y=i.value.$el.children[0];y&&(y.scrollTop=y.scrollHeight,a.value=y.scrollHeight)}})},r=()=>{const y=i.value.$el.children[0];if(y){const q=a.value,j=y.scrollHeight-q;y.scrollTop=y.scrollTop+j,a.value=y.scrollHeight}};function p({scrollTop:y}){y===0&&l.value&&l.value.loadMore()}const u=t,v=m({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",wxid:"",msg_count:0}),w=async()=>{try{const y=await T.post("/api/wxid2user",{wxid:u.wxid});return v.value.account=y[u.wxid].account,v.value.describe=y[u.wxid].describe,v.value.headImgUrl=y[u.wxid].headImgUrl,v.value.nickname=y[u.wxid].nickname,v.value.remark=y[u.wxid].remark,v.value.wxid=u.wxid,y}catch(y){return console.error("Error fetching data wxid2user :",y),[]}},d=async()=>{try{const y=await T.post("/api/msg_count",{wxid:u.wxid});return v.value.msg_count=y[u.wxid],y}catch(y){return console.error("Error fetching data msg_count:",y),[]}};Y(()=>{d(),w(),A(()=>{s()})});const g=m(!1),D=y=>{g.value=y,g.value===!1&&(v.value.wxid="",w())};return I(()=>u.wxid,async(y,q)=>{y!==q&&(w(),d(),g.value=!1,A(()=>{s()}))}),(y,q)=>{const j=x("el-header"),H=x("el-scrollbar"),V=x("el-main"),$=x("el-container");return o(),U($,null,{default:_(()=>[n(j,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:_(()=>[n(pe,{userData:v.value,onExporting:D},null,8,["userData"])]),_:1}),n(V,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:_(()=>[n(H,{ref_key:"scrollbarRef",ref:i,onScroll:p},{default:_(()=>[g.value?(o(),U(Ol,{key:0,wxid:v.value.wxid},null,8,["wxid"])):(o(),U(dl,{key:1,ref_key:"chatRecordsMainRef",ref:l,userData:v.value,setScrollTop:s,updateScrollTop:r},null,8,["userData"]))]),_:1},512)]),_:1})]),_:1})}}}),Nl={class:"progress-bar"},Q=M({__name:"ProgressBar",props:{startORstop:{type:Number,required:!0}},setup(t){const i=m(0),l=m(500),a=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],s=m(new Date().getTime()),r=t,p=()=>{if(r.startORstop===1){i.value=100;return}s.value=new Date().getTime(),!(i.value>=99)&&(i.value>=80&&(l.value=l.value+50),i.value=i.value+1,setTimeout(p,l.value))};return p(),(u,v)=>{const w=x("el-progress");return o(),c("div",Nl,[n(w,{type:"dashboard",percentage:i.value,color:a},null,8,["percentage"])])}}}),Bl={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},Fl={key:0},Al={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},Pl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),Wl={style:{"margin-top":"20px"}},Kl={style:{"margin-top":"20px"}},Gl={key:1},Yl={key:0},Jl={key:1,style:{"background-color":"#fff",width:"80%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},Xl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Ql={style:{"margin-top":"20px"}},Zl={key:0},en=e("br",null,null,-1),tn=e("br",null,null,-1),ln={key:1},nn=e("br",null,null,-1),on=e("br",null,null,-1),sn={key:2},an=e("label",null,"密钥key(必填): ",-1),rn=e("br",null,null,-1),cn={key:3},dn=e("label",null,"merge_all.db 路径(必填): ",-1),un=e("br",null,null,-1),_n=e("label",null,"微信文件夹路径(必填): ",-1),pn=e("br",null,null,-1),vn=e("label",null,"微信原始id(必填): ",-1),hn=e("br",null,null,-1),mn={key:2},fn={key:3,style:{display:"flex","justify-content":"space-between"}},yn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},xn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"使用上次设置")],-1),wn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},gn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),bn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},$n=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),kn=M({__name:"IsAutoShow",emits:["isAutoShow"],setup(t,{emit:i}){const l=m(0),a=m(-1),s=m(""),r=m(!1),p=m([]),u=m(""),v=m(!1),w=m(!1),d=m("false"),g=m(""),D=m(""),y=m(""),q=m(""),j=i,H=async()=>{try{p.value=await T.post("/api/wxinfo"),p.value.length===1&&(V(p.value[0]),u.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout($,5e3))}catch(S){return console.error("Error fetching data:",S),[]}},V=async S=>{g.value="",D.value=S.filePath,y.value=S.key,q.value=S.wxid},$=()=>{D.value===""&&y.value===""&&q.value===""||v.value||(v.value=!0,z())},z=async()=>{if(!v.value)try{v.value=!0,a.value=0;let S={wx_path:D.value,key:y.value,my_wxid:q.value};const b=await T.post("/api/init_key",S);r.value=b.is_init,b.is_init&&(l.value=100,v.value=!1),j("isAutoShow",b.is_init)}catch(S){return l.value=0,w.value=!0,K.alert(S,"error",{confirmButtonText:"确认",callback:b=>{oe({type:"error",message:`action: ${b}`})}}),[]}},C=async()=>{try{let S={wx_path:D.value,merge_path:g.value,my_wxid:q.value};const b=await T.post("/api/init_nokey",S);r.value=b.is_init,b.is_init&&(l.value=100,v.value=!1),j("isAutoShow",b.is_init)}catch(S){return l.value=0,w.value=!0,K.alert(S,"error",{confirmButtonText:"确认",callback:b=>{s.value=""}}),[]}},f=async()=>{try{let S={wx_path:D.value,merge_path:g.value,my_wxid:q.value};const b=await T.post("/api/init_last",S);r.value=b.is_init,b.is_init?(l.value=100,v.value=!1,j("isAutoShow",b.is_init)):(w.value=!0,K.alert("未发现上次的设置数据！","error",{confirmButtonText:"确认",callback:P=>{s.value=""}}))}catch(S){return w.value=!0,K.alert(S,"error",{confirmButtonText:"确认",callback:b=>{s.value=""}}),[]}};return I(s,S=>{S==="auto"?H():S==="custom"||S==="last"&&f()}),(S,b)=>{const P=x("el-button"),ee=x("el-divider"),W=x("el-input");return o(),c("div",Bl,[s.value==="auto"?(o(),c("div",Fl,[v.value?(o(),U(Q,{key:0,startORstop:a.value},null,8,["startORstop"])):(o(),c("div",Al,[Pl,e("div",Wl,[n(L(ne),{data:p.value,onCurrentChange:V,"highlight-current-row":"",style:{width:"100%"}},{default:_(()=>[n(L(N),{"min-width":30,prop:"pid",label:"进程id"}),n(L(N),{"min-width":40,prop:"version",label:"微信版本"}),n(L(N),{"min-width":40,prop:"account",label:"账号"}),n(L(N),{"min-width":40,prop:"name",label:"昵称"}),n(L(N),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",Kl,[n(P,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:$},{default:_(()=>[h("确定"+k(u.value),1)]),_:1})])]))])):s.value==="custom"?(o(),c("div",Gl,[v.value?(o(),c("div",Yl,[v.value?(o(),U(Q,{key:0,startORstop:a.value},null,8,["startORstop"])):E("",!0)])):(o(),c("div",Jl,[Xl,e("div",Ql,[B(e("input",{type:"radio","onUpdate:modelValue":b[0]||(b[0]=R=>d.value=R),value:"true"},null,512),[[F,d.value]]),h(" 使用 KEY          "),B(e("input",{type:"radio","onUpdate:modelValue":b[1]||(b[1]=R=>d.value=R),value:"false"},null,512),[[F,d.value]]),h(" 不使用 KEY "),d.value=="false"?(o(),c("div",Zl,[h(" 说明：1、表示数据库已解密并合并"),en,h("2、合并后的数据库需要包含(MediaMSG,MSG,MicroMsg,OpenIMMsg)这些数据库合并的内容"),tn])):E("",!0),d.value=="true"?(o(),c("div",ln,[h(" 说明：1、自动根据key解密微信文件夹下的数据库"),nn,h("2、必须保证key正确，否则解密失败"),on])):E("",!0),n(ee),d.value=="true"?(o(),c("div",sn,[an,n(W,{placeholder:"密钥key (64位)",modelValue:y.value,"onUpdate:modelValue":b[2]||(b[2]=R=>y.value=R),style:{width:"80%"}},null,8,["modelValue"]),rn])):E("",!0),d.value=="false"?(o(),c("div",cn,[dn,n(W,{placeholder:"(MediaMSG.db,MSG.db,MicroMsg.db,OpenIMMsg.db)合并后的数据库",modelValue:g.value,"onUpdate:modelValue":b[3]||(b[3]=R=>g.value=R),style:{width:"80%"}},null,8,["modelValue"]),un])):E("",!0),_n,n(W,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:D.value,"onUpdate:modelValue":b[4]||(b[4]=R=>D.value=R),style:{width:"80%"}},null,8,["modelValue"]),pn,vn,n(W,{placeholder:"wxid_*******",modelValue:q.value,"onUpdate:modelValue":b[5]||(b[5]=R=>q.value=R),style:{width:"80%"}},null,8,["modelValue"]),hn,d.value=="true"?(o(),U(P,{key:4,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:z},{default:_(()=>[h(" 确定 ")]),_:1})):E("",!0),d.value=="false"?(o(),U(P,{key:5,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:C},{default:_(()=>[h(" 确定 ")]),_:1})):E("",!0)])]))])):s.value==="last"?(o(),c("div",mn)):s.value===""?(o(),c("div",fn,[e("label",yn,[B(e("input",{type:"radio","onUpdate:modelValue":b[6]||(b[6]=R=>s.value=R),value:"last"},null,512),[[F,s.value]]),xn]),e("label",wn,[B(e("input",{type:"radio","onUpdate:modelValue":b[7]||(b[7]=R=>s.value=R),value:"auto"},null,512),[[F,s.value]]),gn]),e("label",bn,[B(e("input",{type:"radio","onUpdate:modelValue":b[8]||(b[8]=R=>s.value=R),value:"custom"},null,512),[[F,s.value]]),$n])])):E("",!0)])}}}),Sn={id:"chat_view",class:"common-layout"},Vn={key:0},Un={key:1},Mn={key:0,style:{height:"calc(100vh)",width:"100%"}},En={key:1,style:{width:"100%",height:"100%"}},zn=M({__name:"ChatView",setup(t){const i=m(!1),l=r=>{i.value=r},a=m(""),s=r=>{a.value=r};return(r,p)=>{const u=x("el-aside"),v=x("el-container");return o(),c("div",Sn,[i.value?(o(),c("div",Un,[n(v,null,{default:_(()=>[n(u,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:_(()=>[n(ue,{onWxid:s})]),_:1}),a.value!=""?(o(),c("div",Mn,[n(Ll,{wxid:a.value},null,8,["wxid"])])):(o(),c("div",En,[n(se)]))]),_:1})])):(o(),c("div",Vn,[n(kn,{onIsAutoShow:l})]))])}}});export{zn as default};
