(this["webpackJsonpstreamlit-molecule-selection"]=this["webpackJsonpstreamlit-molecule-selection"]||[]).push([[0],{16:function(e,t,o){"use strict";o.r(t);var r=o(0),n=o.n(r),c=o(4),s=o.n(c),l=o(1),i=o(18),u=o(2);const a=e=>2*e/3,d=n.a.memo((e=>{const{mol:t,smiles:o,selection:n,nop_selection:c,onMol2DInstanceCreated:s,onSelectionChanged:l}=e,d=Object(r.useRef)(),m=Object(r.useRef)(),h=Object(r.useRef)(),f=Object(r.useRef)(void 0),p=Object(r.useRef)(void 0),v=Object(r.useRef)(!1),[g,b]=Object(i.a)(),{width:w=0}=b.contentRect||{},M=Object(r.useRef)({}),_=Object(r.useCallback)((e=>{var t;if(null===m||void 0===m||null===(t=m.current)||void 0===t||!t.model)return[];const{mMol:o}=m.current.model,r=[];for(let c=0;c<o.getAllAtoms_0();c++){var n;if(o.isSelectedAtom_0(c))r.push(c),e&&null!==(n=M.current[c])&&void 0!==n&&n.size&&M.current[c].forEach((e=>{r.push(e)}))}return r}),[]);return Object(r.useEffect)((()=>{if(d.current&&!(w<=0))if(m.current)h.current&&clearTimeout(h.current),h.current=setTimeout((()=>{m.current.drawPane.setSize_0(w,a(w))}),500);else{m.current=new window.OCL.StructureEditor(d.current,!0,1);const e=m.current;t?e.model.setMolFile_0(t):e.model.setSmiles_0(o),e.toolBar.currentAction.shift_0=!0,e.toolBar.currentAction.rectangular=!0,e.model.mMol.mConnAtom.forEach(((t,o)=>{t.forEach((t=>{1===e.model.mMol.mAtomicNo[t]&&(M.current[o]=M.current[o]||new Set,M.current[o].add(t))}))})),m.current.model.mMol.removeExplicitHydrogens_0(),e.model.cleanMolecule(),e.setAtomHightlightCallback(((e,t)=>{f.current=t?e:void 0})),e.setBondHightlightCallback(((e,t)=>{p.current=t?e:void 0}));const r=e.onMouseClicked;e.onMouseClicked=function(){for(var t=arguments.length,o=new Array(t),n=0;n<t;n++)o[n]=arguments[n];const c=r.call(e,...o);c&&(f.current=-1===c.atom?void 0:c.atom,p.current=-1===c.bond?void 0:c.bond)},n.forEach((t=>{e.model.mMol.setAtomSelection_0(t,!0)})),e.drawPane.draw(),window.__selector=m.current,s(m.current,_(!0))}}),[_,t,s,n,o,w]),Object(u.jsx)("div",{ref:g,children:Object(u.jsx)("div",{onMouseDown:()=>{v.current=!1},onMouseMove:()=>{v.current=!0},onClick:()=>{if(c)return;const{model:e,drawPane:t,toolBar:o}=m.current;if(void 0!==f.current){const o=!e.mMol.isSelectedAtom_0(f.current);e.mMol.setAtomSelection_0(f.current,o),t.draw()}else if(void 0!==p.current){const o=e.mMol.mBondAtom[0][p.current],r=e.mMol.mBondAtom[1][p.current],n=!e.mMol.isSelectedBond_0(p.current);e.mMol.setAtomSelection_0(o,n),e.mMol.setAtomSelection_0(r,n),t.draw()}else v.current?(f.current=void 0,p.current=void 0):(o.currentAction.deselectAllAtoms(),t.draw(),f.current=void 0,p.current=void 0);v.current=!1,l(_(),_(!0))},"view-only":"true",ref:d,style:{width:w,height:a(w)}})})}));class m extends l.b{constructor(){super(...arguments),this.ref=null,this.render=()=>{const e=this.props.args.content,t=this.props.args.ftype,o=this.props.args.preset_selections,r=this.props.args.nop_selection,n=this.props.args.min_allowed_atoms,c=this.props.args.max_allowed_atoms_percent,s=this.props.args.height;return Object(u.jsx)("div",{id:"overflow",style:s?{height:s,overflow:"scroll",scrollBehavior:"smooth"}:{},children:Object(u.jsx)(d,{nop_selection:r,smiles:"smiles"===t?e:"",mol:"mol"===t?e:"",onMol2DInstanceCreated:(e,t)=>{this.forceResize(),this.ref=e;var o=document.getElementById("overflow");o&&(o.scrollTop=o.scrollHeight/2-100)},onSelectionChanged:(e,t)=>{if(r)return;const o=new Set(e),s=document.getElementById("status");if(e.length<n)return s&&(s.innerText="Select at least ".concat(n," heavy atoms.")),this.forceResize(),void l.a.setComponentValue(null);if(e.length>=Math.floor(this.ref.model.mMol.getAllAtoms_0()*c))return s&&(s.innerText="Select up to ".concat(100*c,"% of heavy atoms.")),this.forceResize(),void l.a.setComponentValue(null);const i=[e[0]];for(;i.length;){var u;const e=i.shift();o.delete(e),null===(u=this.ref.model.mMol.mConnAtom[e])||void 0===u||u.forEach((e=>{o.has(e)&&(i.push(e),o.delete(e))}))}if(o.size)return s&&(s.innerText="Selected atoms need to be connected."),this.forceResize(),void l.a.setComponentValue(null);s&&(s.innerText="Selected atoms successfully."),this.forceResize(),l.a.setComponentValue({selection:e,selectionWithHydrogen:t})},selection:o||[]})})}}componentDidMount(){l.a.setFrameHeight()}componentDidUpdate(){l.a.setFrameHeight()}forceResize(){l.a.setFrameHeight()}}var h=Object(l.c)(m);s.a.render(Object(u.jsx)(n.a.StrictMode,{children:Object(u.jsx)(h,{})}),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.3292f3e4.chunk.js.map