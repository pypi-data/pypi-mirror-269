resources:
  cloud: gcp
  cpus: 24+
  memory: 192+
  region: us-central1
  disk_size: 128
  image_id: projects/hms-dev-greenberg-4923/global/images/hanqing-py310cuda121torch222

file_mounts:
  ~/.netrc: ~/.netrc  # for wandb
  /data:
    source: gs://hms-hanqing-analysis
    mode: MOUNT
  /ref:
    source: gs://hms-hanqing-reference
    mode: MOUNT
  /wmb:
    source: gs://hms-hanqing-wmb
    mode: MOUNT
  /tempdata:
    source: gs://hms-hanqing-temp
    mode: MOUNT

setup: |
  sudo mount 192.168.179.186:/filestore /mnt/filestore
  echo 'export SCPRINTER_DATA=/mnt/filestore/scprinter' >> ~/.bashrc
  ln -s /mnt/filestore /home/gcpuser/sky_workdir/

  if [ -f $HOME/.SKIPSETUP ]
  then
    echo "Skip setup"
  else
    pip install git+https://github.com/lhqing/scmallet.git

    pip install -e /mnt/filestore/pkg/bolero-process
    pip install -e /mnt/filestore/pkg/bolero
    pip install -e /mnt/filestore/pkg/scPrinter
    touch $HOME/.SKIPSETUP
  fi

run: |
  nohup jupyter-lab --LabApp.token='' --no-browser --port 8898 > ~/jupyter.log 2>&1 &
